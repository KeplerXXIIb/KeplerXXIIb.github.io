---
title: 51单片机学习记录
date: 2025-10-18
cover_image: /imgs/XXXXXXXXX.jpg
categories: tech-blog
tags:
  - CS
---

![](/imgs/XXXXXXXXXXX)

# 目录
## 学习资料来源
https://jiangxiekeji.com
https://www.bilibili.com/video/BV1Mb411e7re/?vd_source=5e2a8b05cdeecce93e566eee1d4ecbea

## 学习准备
### 开发工具介绍及软件安装
硬件：51单片机开发板、Windows电脑
软件：Keil5、STC-ISP、ch341ser（开发板驱动）

>Keil/IAR 是功能强大的集成开发环境，而 STC-ISP 的核心是一个专用于 STC 系列 8051 内核单片机的程序烧录工具。
>烧录、刻录，write、program、burn

>.hex文件和.axf文件的核心
>.hex：​​用于烧录到单片机Flash存储器中的最终二进制文件​​，包含程序代码和数据
>.axf：​​调试和仿真专用的可执行文件​​，包含完整的调试信息（符号表、地址映射等）

>为什么叫51单片机？
>简单直接的答案是：​​因为它使用的指令集架构叫做“Intel MCS-51”，所以简称“51单片机”。​
​​“51单片机”​​ 得名于英特尔经典的 ​​MCS-51​​ 微控制器系列，特指所有使用​​8051兼容内核​​的微控制器。
它是一个​​技术架构的代名词​​，而非某个特定型号的芯片。
由于其​​结构经典、生态完善、成本低廉​​，至今仍在嵌入式领域占据重要地位，是初学者入门嵌入式系统的绝佳选择之一。

### 单片机及开发板介绍
所见即所得，各模块简单介绍
![](/imgs/2025101905.jpg)
（顺序：从右上角灯组开始顺时针介绍）
>LED灯组
矩阵按键
红外接收头
AT下载
无线模块
独立按键
USB转TTL模块：TTL（Transistor-Transistor Logic：晶体管-晶体管逻辑电平）信号系统
DS1302：时钟芯片，应用：时钟、闹钟、定时控制等等
复位：
AD/DA：模数/数模转换模块，光敏电阻、电位器、热敏电阻、外接接口等
74H595：控制扩展IO接口
步进电机
分频器：蜂鸣器
138译码器：驱动数码管
24C02：一种ROM，E²PROM：FlashRom比E²更好，但是这款的Flaash只能存储程序，其他一些掉电需保存的数据，便存储到54C02中
DS18b20：实时检测温度
74HC245：驱动数码管，旧版新版，驱动数码管的芯片不一样，功能几乎没差别
电位器：调节液晶屏的对比度、清晰度
排座：插液晶屏
点阵屏：每个孔都有一个LED灯，8*8

命名规则
![](/imgs/2025101902.jpg)

简易block图
![](/imgs/2025101901.jpg)
STC芯片管脚图
![](/imgs/2025101903.jpg)
STC芯片内部结构图
![](/imgs/2025101904.jpg)
开发板原理图
![](/imgs/2025101906.jpg)

## 具体操作
### 点亮一个LED
LED元器件介绍
电阻的元器件标注规则：102=1K
10 00

串联电阻是为了给LED限制电流，防止LED损坏

C51数据类型，联系C语言数据类型
### 独立按键

按键的抖动、按键的消抖：1、硬件加电路 2、软件过滤

### 数码管
数码管介绍
数码管引脚定义：共阴极/共阳极连接
静态/动态数码管显示，动态数码管显示利用了人眼的视觉暂留和数码管余晖原理，动态扫描实现“同时显示几位数字”的功能

芯片的“使能”控制端口
38译码器原理介绍，输出某位低电平或高电平
74HC245：DIR的LE接高电平，就从写数据（A->B），如果接低电平，就反过来，读数据（B->A）。LE与VCC间，可以通过一个键帽连接，键帽插上的时候，就是LE与VCC相连（接了高电平）。

>问题：单片机中，为什么低电平驱动能力强,高电平驱动能力弱?（腾讯元宝调动ds回答）
低电平驱动（灌电流）能力强，而高电平驱动（拉电流）能力弱​​。根本原因：根本原因在于单片机I/O引脚输出级的典型电路设计。它通常由一个“上拉”PMOS管和一个“下拉”NMOS管组成，构成所谓的“推挽输出”或“图腾柱输出”结构。​​PMOS管通常导通电阻大，	NMOS管通常导通电阻小。

与VCC相接的元器件（在电路图中是两条横线）是电容。104 = 10 0000pF
>什么是电容？
>电容是容纳电荷的元器件,由两个相互靠近的导体和中间绝缘介质构成。作用包括存储电能、滤波、耦合信号、定时、谐振等。
电容描述的是器件储存电荷的能力。电容的定义是器件的电荷量与电势之比，常用C表示。电容的量纲是L-2M-1T4I2，国际单位制下单位是F（法拉）。

由于引脚冲突，点亮数码管的同时，之前的8个LED也有可能亮，此处忽略。


为什么会产生影？
原因：位选 段选 位选 段选 位选 段选 位选 段选 ......
因为单片机执行代码速度很快，位选和段选会串

数码管的消影如何完成？
在两个代码之间添加清零操作

数码管驱动方式：单片机直接扫描、专用驱动芯片
直接扫描：硬件设备简单，但是会浪费大量的CPU时间，一旦CPU在此期间有做其他任务未扫描，数码管显示就可能会闪烁。
专用芯片：如TM1640、74HC595

### 模块化编程
.c、.h文件的使用
.h文件的编写方法
预编译，宏

### LCD1602调试工具

有哪些调试工具？
数码管：需要不断刷新，显示内容少
串口：需要连接电脑，通过电脑显示内容
LCD1602显示屏：注意，使用该屏幕后，由于引脚冲突，8位的LED和数码管会乱码

### 矩阵键盘
矩阵键盘介绍：为了减少I/O口占用，通常将按键排列成矩阵形式

扫描的概念
输出扫描

输入扫描

其实显示器原理是也是扫描实现的。

由于引脚冲突，P15与步进电机、蜂鸣器相连，所以在扫描矩阵按键时，如果该引线的按键按下，步进电机（如果连接了的话）和蜂鸣器可能会工作，此处忽略。
这里为了避免这个现象频繁发生，采用逐列扫描，因为P15线在行上。 

弱上拉，强下压

矩阵键盘在逐行扫描时会遇到一些问题，该问题不是由于扫描方式本身导致的，而是由于单片机电路设计导致的。

>STC89C52单片机中，在编写代码读取某个引脚的时候，实际发生的物理过程是什么样的？
腾讯元宝回答：总结：STC89C52读取引脚的物理过程
​​软件准备​​：代码必须先向端口锁存器写入 1，以关闭强下拉MOSFET。
​​CPU发起读取​​：执行读取端口的汇编指令。
​​硬件“准备”引脚​​：内部硬件产生一个短暂的负脉冲，尝试将引脚拉低，以测试外部电路的驱动能力。
​​电平判定​​：
外部为强低电平 -> 引脚电压被成功拉低 -> 判定为 0。
外部为高电平或悬空 -> 弱上拉电阻将电压恢复为高 -> 判定为 1。
​​数据锁存与返回​​：最终的电平被采样、锁存，并返回给CPU。
简而言之，STC89C52读取引脚不是一个被动的“检测电压”过程，而是一个包含短暂“主动测试”的交互过程。理解这一点对于正确使用 8051 系列单片机至关重要。

>无源蜂鸣器和有源蜂鸣器的区别
无源蜂鸣器需外部驱动电路支持，而有源蜂鸣器内置振荡源；前者通过调节PWM信号可实现更丰富的音效，后者仅能发出固定频率声音。

>由于矩阵键盘控制行的引脚中有P15，在按行扫描时，会给到P15有时高电平有时低电平，由于P15与蜂鸣器相连，且单片机上的蜂鸣器是无源蜂鸣器，所以在逐行扫描时，会导致蜂鸣器工作。

单片机引脚的工作原理，VCC-电阻-开关-引脚-GND，引脚和GND之间接上连接线，连接到施密特读取器，可读取电平高低信息。

弱上拉模式
推广输入
高阻输入
开漏输出

### 定时器
Delay函数，作用就是让CPU等待，在等待期间无法完成其他任务。

>51单片机的计时器属于单片机的内部资源，其电路的连接和运转均在单片机内部完成
定时器的作用：
1.用于计时系统，可实现软件计时，或者使程序每隔一固定时间完成一项操作
2.替代代码中长时间的Delay，提高CPU的运行效率和处理速度
（例：如果按原来的代码，如果在delay期间按按键，CPU检测不到）
3.其它：操作系统实行多任务等等......

定时器个数：3个（T0、T1、T2），T0和T1与传统的51单片机兼容，T2是此型号单片机增加的资源

注意：定时器的资源和单片机的型号是关联在一起的，不同的型号可能会有不同的定时器个数和操作方式，但一般来说，T0和T1的操作方式是所有51单片机所共有的

51单片机定时器工作模式，最常用的是模式：16位定时器

内部原理图：
时钟->计数器->中断系统

时钟：提供计数单元的时钟脉冲
计数器：时钟计数
中断系统：产生中断，执行定时任务



定时器时钟
有内部来源和外部来源（T0Pin/T1Pin）

分频

功能选择：计数器（C）/计数器（T）

中断系统
高低级终端系统，中断嵌套
中断流程

STC89C52中断资源

定时器相关寄存器

中断寄存器

### 串口
>串口的定义：串行通信接口或串行通讯接口（通常指COM接口），是采用串行通信方式的扩展接口。
常见的通信接口比较

51单片机的UART

串口参数及时序图

串口模式图

SBUF（Serial Data Buffer）是单片机中用于串行通信的缓冲寄存器。
在异步串口通信中，SBUF作为数据传输枢纽，支持CPU与外部设备间的双向通信。 ‌

串口相关寄存器

串口与中断系统

串口操作中配置计时器
之前的项目使用的是16位模式，但是因为16位模式中，重置计时器需要执行两条语句，会影响计时精度，在串口传输数据的过程中，精度比较重要，所以需要重新配置计时器的模式。
自动重装模式：自动重装模式是定时器在溢出后自动将预设的初值重新装载到计数寄存器中的工作方式，主要用于维持定时器持续运行。

一个函数不能既在主函数中和中断函数中出现，不然会导致函数重入，主函数中的该函数过程可能会遭到破坏。

如何计算波特率？
查看操作手册，计算溢出率，然后根据计时器原理图，计算出实际波特率。

数据显示模式
HEX/十六进制/二进制
文本模式/字符模式：以原始数据编码后的形式显示（ASCII表转换）

### LED点阵屏
一般点阵屏像素点数量为8的倍数。

显示原理
与数码管类似

74H595
74H595是串行输入并行输出的移位寄存器，可以用3根线输入串行数据，8根线输出并行数据。多片级联后，可输出16位、24位、32位等，常用于IO口扩展。
串行与并行的区别
SER
SERCLK：上升沿移位
RCLK：上升沿锁存

74H595芯片与138译码器的区别：138只能控制一位有高/低电平

问题：单片机的IO口能不能直接接到LED点阵的引脚上？
答：不太可行。
因为单片机的IO口是弱上拉，当输出高电平是电流较小，可能会影响LED点阵的功能。
如果要接，可以考虑接PNP/NPN三极管，相当于一个中继器。

而且74H595是恒压输出，同样的电压点亮1个灯和8个灯，亮度区别肯定比较大。这就是示例中LED点阵灯的亮度不一样亮的原因。如果想要保证灯的亮度均匀，可考虑使用恒流芯片。（电流恒定）

sfr与sbit的作用
sfr：special function register
sbit：special bit

可位寻址/不可位寻址

语法如下：
注意：这里的^含义并不是按位亦或，而是该语句使用的语法
sbit 位名 = 寄存器^位位置;
sbit 位名 = 地址^位位置;
sbit 位名 = 直接地址;

定义数组时，默认数组存储在RAM中，如果要存放比较多的数据，可以在数组定义前增加"code"，这样定义的数组就会被存储在Flash存储中，Flash的存储空间更大。
将数组放在Flash中有个缺点，就是在程序运行的过程中不能更改，如果放在RAM中则可以更改。

DS1302芯片、DS3221
单片机本身也可以计时，为什么要单独地使用一块时钟芯片？
1.单片机时钟精度不高
2.单片机会占用CPU
3.单片机时钟不能断电，专门的时钟芯片内置电池，断电时会自动切换时钟电源。

RTC（Real Time Clock）实时时钟，是一种集成电路，通常称为时钟芯片。

涓细电流充电能力指设备在电池充满后，通过极低电流（通常为0.1W左右）持续为电池补电，维持电池处于满电状态的技术。 ‌
3个部分：电源、晶振、控制

在通讯协议中，时序图很常见

不同通讯协议的特点

BCD码：用4位二进制数来表示1位十进制数

逻辑取反（!）与按位取反（~）的区别，注意区分！

### 蜂鸣器介绍
蜂鸣器是一种将电信号转换为声音信号的器件，常用来产生设备的按键音、报警音等提示信号
蜂鸣器按驱动方式可分为有源蜂鸣器和无源蜂鸣器
有源蜂鸣器：内部自带振荡源，将正负极接上直流电压即可持续发声，频率固定
无源蜂鸣器：内部不带振荡源，需要控制器提供振荡脉冲才可发声，调整提供振荡脉冲的频率，可发出不同频率的声音

ULN2003驱动芯片
单片机不能直接驱动蜂鸣器，通过与驱动芯片连接达到驱动蜂鸣器的目的。

乐理部分
谱号、调号和拍号
如果某个音符有#，该小节的该音符同样#（但在谱上不再标出）
C大调和D大调的区别

### AT24C02

引脚及其应用电路

内部结构框图

I2C总线介绍

>IIC（Inter-Integrated Circuit）全称集成电路总线，由飞利浦公司于1980年代为连接主板、嵌入式系统及手机的低速周边设备而开发，采用双线制串行通信架构，包含串行数据线（SDA）和串行时钟线（SCL）。

I2C电路规范

在编程时，注意代码结构，需要低耦合。
所以在本节第二个例子的实现过程中，单独编写了循环函数（或者说驱动函数），然后把此类函数放到中断函数中，实现调用，而不是直接将函数写到中断函数中。

之前实现按键的功能（检测、消抖等），是通过CPU等待来实现的，当此类需要检测的函数多了之后，这个方案便需要优化。

使用定时器来检测按键按下/恢复，设置间隔为20ms后，不管开始检测时时间点在哪个位置，只要检测电位的变化，然后根据变化就可以看出是按下/按住/恢复

### DS18B20温度传感器
寄生供电

### 直流电机介绍
直流电机
步进电机
舵机
无刷电机
空心杯电机

惯性系统 PWM脉冲宽度调制

许多新的单片机用硬件来实现PWM功能

### AD/DA，模数/数模转换

### 红外遥控简介
NEC标准



