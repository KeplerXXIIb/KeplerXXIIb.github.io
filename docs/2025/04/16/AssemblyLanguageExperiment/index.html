<!DOCTYPE html>
<html lang="en">
    <head prefix="og: https://ogp.me/ns#">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="color-scheme" content="light dark">
  
  <title>汇编语言实验过程记录202504（已完结） - KeplerXXIIb</title>
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    <link rel='manifest' href='/manifest.json'>
  

  
  
  
  <meta property="og:title" content="汇编语言实验过程记录202504（已完结） - KeplerXXIIb" />
  
  <meta property="og:type" content="article" />
  
  <meta property="og:url" content="http://example.com/2025/04/16/AssemblyLanguageExperiment/index.html" />
  
  <meta property="og:image" content="/imgs/20250416001.jpg" />
  
  <meta property="og:article:published_time" content="2025-04-16T00:00:00.000Z" />
  
  <meta property="og:article:author" content="KeplerXXIIb" />
  
  

  
<link rel="stylesheet" href="/css/var.css">

  
<link rel="stylesheet" href="/css/main.css">

  
<link rel="stylesheet" href="/css/typography.css">

  
<link rel="stylesheet" href="/css/code-highlighting.css">

  
<link rel="stylesheet" href="/css/components.css">

  
<link rel="stylesheet" href="/css/nav.css">

  
<link rel="stylesheet" href="/css/paginator.css">

  
<link rel="stylesheet" href="/css/footer.css">

  
<link rel="stylesheet" href="/css/post-list.css">

  
  
<link rel="stylesheet" href="/css/rainbow-banner.css">

  
  
  
<link rel="stylesheet" href="/css/toc.css">

  
  
  
  
  
<link rel="stylesheet" href="/css/post.css">

  
  
  
  
  

  
<meta name="generator" content="Hexo 7.2.0"></head>
    <body
        data-color-scheme="auto"
        data-uppercase-categories="true"
        
        data-rainbow-banner="true"
        data-rainbow-banner-shown="auto"
        data-rainbow-banner-month="2"
        data-rainbow-banner-colors="#e50000,#ff8d00,#ffee00,#008121,#004cff,#760188"
        
        data-config-root="/"
        
        data-toc="true"
        data-toc-max-depth="2"
        
        
    >
        <nav id="theme-nav">
    <div class="inner">
        <a class="title" href="/">Blog</a>
        <div class="nav-arrow"></div>
        <div class="nav-items">
            <a class="nav-item nav-item-home" href="/">Home</a>
            
            
            <a class="nav-item" href="/archives">Archives</a>
            
            
            
            <a class="nav-item" href="/friends">Friends</a>
            
            
            
            <a class="nav-item" href="/projects">Projects</a>
            
            
            
            <a class="nav-item" href="/about">About</a>
            
            
            
            <a class="nav-item nav-item-github nav-item-icon" href="https://github.com/KeplerXXIIb" target="_blank" aria-label="GitHub">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-codepen nav-item-icon" href="/codepan" target="_blank" aria-label="CodePen">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-patreon nav-item-icon" href="/patreon" target="_blank" aria-label="Patreon">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-mastodon nav-item-icon" href="/mastodon" target="_blank" aria-label="Mastodon">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-discord nav-item-icon" href="/discord" target="_blank" aria-label="Discord">&nbsp;</a>
            
            
            
            <a class="nav-item nav-item-search nav-item-icon" href="/search" target="_blank" aria-label="Search">&nbsp;</a>
            
            
        </div>
    </div>
</nav>
        
<article class="post">
    <div class="meta">
        
        <div class="categories text-uppercase">
        
            <a href="/categories/tech-blog/">tech-blog</a>
        
        </div>
        

        
        <div class="date" id="date">
            <span>April</span>
            <span>16,</span>
            <span>2025</span>
        </div>
        

        <h1 class="title">汇编语言实验过程记录202504（已完结）</h1>
    </div>

    <div class="divider"></div>

    <div class="content">
        <h1 id="汇编语言实验过程记录"><a href="#汇编语言实验过程记录" class="headerlink" title="汇编语言实验过程记录"></a>汇编语言实验过程记录</h1><p>##目录</p>
<ul>
<li><a href="#%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E5%AE%9E%E9%AA%8C%E8%BF%87%E7%A8%8B%E8%AE%B0%E5%BD%95">汇编语言实验过程记录</a><ul>
<li><a href="#%E5%AE%9E%E9%AA%8C%E6%9D%A5%E6%BA%90">实验来源</a></li>
<li><a href="#%E7%9B%B8%E5%85%B3%E9%93%BE%E6%8E%A5">相关链接</a></li>
<li><a href="#%E5%AE%9E%E9%AA%8C%E5%86%85%E5%AE%B9">实验内容</a><ul>
<li><a href="#%E5%AE%9E%E9%AA%8C1">实验1</a><ul>
<li><a href="#%E5%AE%9E%E9%AA%8C%E5%86%85%E5%AE%B9-1">实验内容</a></li>
<li><a href="#%E5%AE%9E%E9%AA%8C%E8%BF%87%E7%A8%8B%E5%8F%8A%E7%BB%93%E8%AE%BA">实验过程及结论</a></li>
</ul>
</li>
<li><a href="#%E5%AE%9E%E9%AA%8C2">实验2</a><ul>
<li><a href="#%E5%AE%9E%E9%AA%8C%E5%86%85%E5%AE%B9-2">实验内容</a></li>
<li><a href="#%E5%AE%9E%E9%AA%8C%E8%BF%87%E7%A8%8B%E5%8F%8A%E7%BB%93%E8%AE%BA-1">实验过程及结论</a></li>
</ul>
</li>
<li><a href="#%E5%AE%9E%E9%AA%8C3">实验3</a><ul>
<li><a href="#%E5%AE%9E%E9%AA%8C%E5%86%85%E5%AE%B9-3">实验内容</a></li>
<li><a href="#%E5%AE%9E%E9%AA%8C%E8%BF%87%E7%A8%8B%E5%8F%8A%E7%BB%93%E8%AE%BA-2">实验过程及结论</a></li>
</ul>
</li>
<li><a href="#%E5%AE%9E%E9%AA%8C4">实验4</a><ul>
<li><a href="#%E5%AE%9E%E9%AA%8C%E5%86%85%E5%AE%B9-4">实验内容</a></li>
<li><a href="#%E5%AE%9E%E9%AA%8C%E8%BF%87%E7%A8%8B%E5%8F%8A%E7%BB%93%E8%AE%BA-3">实验过程及结论</a></li>
</ul>
</li>
<li><a href="#%E5%AE%9E%E9%AA%8C5">实验5</a><ul>
<li><a href="#%E5%AE%9E%E9%AA%8C%E5%86%85%E5%AE%B9-5">实验内容</a></li>
<li><a href="#%E5%AE%9E%E9%AA%8C%E8%BF%87%E7%A8%8B%E5%8F%8A%E7%BB%93%E8%AE%BA-4">实验过程及结论</a></li>
</ul>
</li>
<li><a href="#%E5%AE%9E%E9%AA%8C6">实验6</a><ul>
<li><a href="#%E5%AE%9E%E9%AA%8C%E5%86%85%E5%AE%B9-6">实验内容</a></li>
<li><a href="#%E5%AE%9E%E9%AA%8C%E8%BF%87%E7%A8%8B%E5%8F%8A%E7%BB%93%E8%AE%BA-5">实验过程及结论</a></li>
</ul>
</li>
<li><a href="#%E5%AE%9E%E9%AA%8C7">实验7</a><ul>
<li><a href="#%E5%AE%9E%E9%AA%8C%E5%86%85%E5%AE%B9-7">实验内容</a></li>
<li><a href="#%E5%AE%9E%E9%AA%8C%E8%BF%87%E7%A8%8B%E5%8F%8A%E7%BB%93%E8%AE%BA-6">实验过程及结论</a></li>
</ul>
</li>
<li><a href="#%E5%AE%9E%E9%AA%8C8">实验8</a><ul>
<li><a href="#%E5%AE%9E%E9%AA%8C%E5%86%85%E5%AE%B9-8">实验内容</a></li>
<li><a href="#%E5%AE%9E%E9%AA%8C%E8%BF%87%E7%A8%8B%E5%8F%8A%E7%BB%93%E8%AE%BA-7">实验过程及结论</a></li>
</ul>
</li>
<li><a href="#%E5%AE%9E%E9%AA%8C9">实验9</a><ul>
<li><a href="#%E5%AE%9E%E9%AA%8C%E5%86%85%E5%AE%B9-9">实验内容</a></li>
<li><a href="#%E5%AE%9E%E9%AA%8C%E8%BF%87%E7%A8%8B%E5%8F%8A%E7%BB%93%E8%AE%BA-8">实验过程及结论</a></li>
</ul>
</li>
<li><a href="#%E5%AE%9E%E9%AA%8C10">实验10</a><ul>
<li><a href="#%E5%AE%9E%E9%AA%8C%E5%86%85%E5%AE%B9-10">实验内容</a></li>
<li><a href="#%E5%AE%9E%E9%AA%8C%E8%BF%87%E7%A8%8B%E5%8F%8A%E7%BB%93%E8%AE%BA-9">实验过程及结论</a></li>
</ul>
</li>
<li><a href="#%E5%AE%9E%E9%AA%8C11">实验11</a><ul>
<li><a href="#%E5%AE%9E%E9%AA%8C%E5%86%85%E5%AE%B9-11">实验内容</a></li>
<li><a href="#%E5%AE%9E%E9%AA%8C%E8%BF%87%E7%A8%8B%E5%8F%8A%E7%BB%93%E8%AE%BA-10">实验过程及结论</a></li>
</ul>
</li>
<li><a href="#%E5%AE%9E%E9%AA%8C12">实验12</a><ul>
<li><a href="#%E5%AE%9E%E9%AA%8C%E5%86%85%E5%AE%B9-12">实验内容</a></li>
<li><a href="#%E5%AE%9E%E9%AA%8C%E8%BF%87%E7%A8%8B%E5%8F%8A%E7%BB%93%E8%AE%BA-11">实验过程及结论</a></li>
</ul>
</li>
<li><a href="#%E5%AE%9E%E9%AA%8C13">实验13</a><ul>
<li><a href="#%E5%AE%9E%E9%AA%8C%E5%86%85%E5%AE%B9-13">实验内容</a></li>
<li><a href="#%E5%AE%9E%E9%AA%8C%E8%BF%87%E7%A8%8B%E5%8F%8A%E7%BB%93%E8%AE%BA-12">实验过程及结论</a></li>
</ul>
</li>
<li><a href="#%E5%AE%9E%E9%AA%8C14">实验14</a><ul>
<li><a href="#%E5%AE%9E%E9%AA%8C%E5%86%85%E5%AE%B9-14">实验内容</a></li>
<li><a href="#%E5%AE%9E%E9%AA%8C%E8%BF%87%E7%A8%8B%E5%8F%8A%E7%BB%93%E8%AE%BA-13">实验过程及结论</a></li>
</ul>
</li>
<li><a href="#%E5%AE%9E%E9%AA%8C15">实验15</a><ul>
<li><a href="#%E5%AE%9E%E9%AA%8C%E5%86%85%E5%AE%B9-15">实验内容</a></li>
<li><a href="#%E5%AE%9E%E9%AA%8C%E8%BF%87%E7%A8%8B%E5%8F%8A%E7%BB%93%E8%AE%BA-14">实验过程及结论</a></li>
</ul>
</li>
<li><a href="#%E5%AE%9E%E9%AA%8C16">实验16</a><ul>
<li><a href="#%E5%AE%9E%E9%AA%8C%E5%86%85%E5%AE%B9-16">实验内容</a></li>
<li><a href="#%E5%AE%9E%E9%AA%8C%E8%BF%87%E7%A8%8B%E5%8F%8A%E7%BB%93%E8%AE%BA-15">实验过程及结论</a></li>
</ul>
</li>
<li><a href="#%E5%AE%9E%E9%AA%8C17">实验17</a><ul>
<li><a href="#%E5%AE%9E%E9%AA%8C%E5%86%85%E5%AE%B9-17">实验内容</a></li>
<li><a href="#%E5%AE%9E%E9%AA%8C%E8%BF%87%E7%A8%8B%E5%8F%8A%E7%BB%93%E8%AE%BA-16">实验过程及结论</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="实验来源"><a href="#实验来源" class="headerlink" title="实验来源"></a>实验来源</h2><p>《汇编语言》（第3版，王爽著）P92<br><img src="/imgs/20250416001.jpg"></p>
<h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><p><a target="_blank" rel="noopener" href="https://www.dosbox.com/">https://www.dosbox.com</a><br><a target="_blank" rel="noopener" href="https://www.masm32.com/index.htm">https://www.masm32.com/index.htm</a><br><a target="_blank" rel="noopener" href="https://github.com/froginwell/assembly">https://github.com/froginwell/assembly</a><br><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1cb411L7Hv/?spm_id_from=333.337.search-card.all.click&vd_source=5e2a8b05cdeecce93e566eee1d4ecbea">https://www.bilibili.com/video/BV1cb411L7Hv/?spm_id_from=333.337.search-card.all.click&amp;vd_source=5e2a8b05cdeecce93e566eee1d4ecbea</a><br><a target="_blank" rel="noopener" href="https://www.masm32.com/index.htm">https://www.masm32.com/index.htm</a></p>
<h2 id="实验内容"><a href="#实验内容" class="headerlink" title="实验内容"></a>实验内容</h2><h3 id="实验1"><a href="#实验1" class="headerlink" title="实验1"></a>实验1</h3><h4 id="实验内容-1"><a href="#实验内容-1" class="headerlink" title="实验内容"></a>实验内容</h4><p><img src="/imgs/20250414-1-expt1-p1.jpg"><br><img src="/imgs/20250414-2-expt1-p2.jpg"></p>
<h4 id="实验过程及结论"><a href="#实验过程及结论" class="headerlink" title="实验过程及结论"></a>实验过程及结论</h4><p>1. </p>
<ol>
<li>Dosbox中默认输入数据时就是十六进制，不需要加入“H”。</li>
<li>al、bl代表的是ax寄存器低位（8位）、bx寄存器低位（8位）</li>
<li>al&#x2F;bl进行运算时，如果遇到进位溢出，那么高位不会自动变化，只是改变了标志位。</li>
</ol>
<ol start="2">
<li>可利用jmp指令实现循环</li>
<li>由于DosBox是模拟的环境，这里在ROM中查找生产日期的实验未成功，因为FFFF00H~FFFFFH内存地址存的值是空。</li>
<li>在A0000<del>BFFFF区间写入数据时，指令无效，因为这部分是显存地址的所在空间（A0000</del>BFFFF）.<br><img src="/imgs/20250414-3-expt1-p3.jpg"></li>
</ol>
<h3 id="实验2"><a href="#实验2" class="headerlink" title="实验2"></a>实验2</h3><h4 id="实验内容-2"><a href="#实验内容-2" class="headerlink" title="实验内容"></a>实验内容</h4><p><img src="/imgs/20250414-4-expt2-p1.jpg"><br><img src="/imgs/20250414-5-expt2-p2.jpg"></p>
<h4 id="实验过程及结论-1"><a href="#实验过程及结论-1" class="headerlink" title="实验过程及结论"></a>实验过程及结论</h4><ol>
<li></li>
</ol>
<p>1)<br>  ax&#x3D;C0EA,ax&#x3D;C0FC;<br>  bx&#x3D;30F0,bx&#x3D;6021;<br>  ss&#x3D;2200,sp&#x3D;00FE,修改的内存单元的地址是2200:00FE、2200:00FF;内容为C0FC;<br>  ss&#x3D;2200,sp&#x3D;00FC,修改的内存单元的地址是2200:00FC、2200:00FD;内容为6021’<br>  sp&#x3D;00FE,ax&#x3D;6021;<br>  sp&#x3D;0100,ax&#x3D;6021;<br>  ss&#x3D;2200,sp&#x3D;00FE,修改的内存单元的地址是2200:00FE、2200:00FF;内容为F030;<br>  ss&#x3D;2200,sp&#x3D;00FC,修改的内存单元的地址是2200:00FC、2200:00FD;内容为312F；</p>
<ol start="2">
<li>为什么2000:0~2000:f的内容会发生变化？<br>ss:sp指向的地址是2000:0010，此时2000:0000 0010存储的是下一条要执行的指令的地址信息（即CS、IP等寄存器的信息）</li>
</ol>
<h3 id="实验3"><a href="#实验3" class="headerlink" title="实验3"></a>实验3</h3><h4 id="实验内容-3"><a href="#实验内容-3" class="headerlink" title="实验内容"></a>实验内容</h4><p><img src="/imgs/20250415-1-expt3-p1.jpg"></p>
<h4 id="实验过程及结论-2"><a href="#实验过程及结论-2" class="headerlink" title="实验过程及结论"></a>实验过程及结论</h4><p>1.<br>2.<br>  <img src="/imgs/20250416-1-expt3-p2.jpg"><br>  <img src="/imgs/20250416-2-expt3-p3.jpg"><br>  <img src="/imgs/20250416-3-expt3-p4.jpg"><br>3.<br>用debug加载t1.exe，查看PSP内容。可参考P92。<br>操作系统调用DosBox（这里是使用dosbox模拟x8086 16位，下一步这里直接写成DOS，就不再写DosBox套娃了），DOS调用command，command调用debug.exe，debug调用t1.exe。<br>程序段前缀PSP(Program Segment Prefix)与程序区虽然内存地址连续，但是段地址不同。其中PSP大小256字节。设PSP地址为SA:0，程序区地址则为SA+10H:0。<br>CS:IP存储CPU要执行的下一条指令，根据2.可知，程序段段地址为076AH:0，所以PSP地址为075AH:0。使用debug中”-d”语句查看该地址内存内容得下图，头两个字节即CD 20。<br>  <img src="/imgs/20250416-4-expt3-p5.jpg"></p>
<h3 id="实验4"><a href="#实验4" class="headerlink" title="实验4"></a>实验4</h3><h4 id="实验内容-4"><a href="#实验内容-4" class="headerlink" title="实验内容"></a>实验内容</h4><p><img src="/imgs/20250416-5-expt4-p1.jpg"><br><img src="/imgs/20250416-6-expt4-p2.jpg"></p>
<h4 id="实验过程及结论-3"><a href="#实验过程及结论-3" class="headerlink" title="实验过程及结论"></a>实验过程及结论</h4><ol>
<li><img src="/imgs/20250416-7-expt4-p3.jpg"></li>
<li>  在做part2时，遇到了几个问题。<br><img src="/imgs/20250416-8-expt4-p4.jpg"></li>
</ol>
<ol>
<li>忘记了立即数不能直接传给段寄存器，我把立即数传给ds报错；</li>
<li>使用”段:[偏移地址]”表示地址时，”[]”只能填index或寄存器，我填了寄存器的低位，报错；</li>
<li>在改正2)和3)后，可以成功编译、链接、生成exe文件。但是执行时DOS窗口卡住无法输入，关掉重试后，DOS窗口还是卡住，DOS状态窗口直接报错：非法读取。<br><img src="/imgs/20250416-11-expt4-p7.jpg"><br>最后的问题3)，在分析报错+DeepSeek搜索后发现错误，地址换算错了，取到的地址为2h，这部分内存地址不可随意写入，已解决。<br><img src="/imgs/20250417-1-expt4-p9.jpg"><br><img src="/imgs/20250416-9-expt4-p5.jpg"><br><img src="/imgs/20250416-10-expt4-p6.jpg"></li>
</ol>
<ol start="3">
<li><img src="/imgs/20250416-12-expt4-p8.jpg"><br>补充的两个空分别为 ss,10。</li>
</ol>
<ol>
<li>赋值的是汇编代码的二进制表示，从 mov ax,ss 到loop s。</li>
<li>通过debug&gt;-d 0:200可查看最后占用的内存地址，从而计算出复制的字节数</li>
</ol>
<h3 id="实验5"><a href="#实验5" class="headerlink" title="实验5"></a>实验5</h3><h4 id="实验内容-5"><a href="#实验内容-5" class="headerlink" title="实验内容"></a>实验内容</h4><p><img src="/imgs/20250417-1-expt5-p1.jpg"><br><img src="/imgs/20250417-2-expt5-p2.jpg"><br><img src="/imgs/20250417-3-expt5-p3.jpg"><br><img src="/imgs/20250417-4-expt5-p4.jpg"><br><img src="/imgs/20250417-5-expt5-p5.jpg"></p>
<h4 id="实验过程及结论-4"><a href="#实验过程及结论-4" class="headerlink" title="实验过程及结论"></a>实验过程及结论</h4><ol>
<li>程序执行前debug -r如图：<br><img src="/imgs/20250417-6-expt5-p6.jpg"></li>
</ol>
<p>程序执行前，三个段的内容如下：<br><img src="/imgs/20250417-9-expt5-p9.jpg"><br><img src="/imgs/20250417-10-expt5-p10.jpg"></p>
<p>程序执行后，三个段的内容如下：<br><img src="/imgs/20250417-7-expt5-p7.jpg"><br><img src="/imgs/20250417-8-expt5-p8.jpg"></p>
<ol>
<li>程序返回前，data段中的数据组成如图：<br><img src="/imgs/20250417-7-expt5-p7.jpg"><br>组成部分有原来的数据+不知名数据+DOS中的PSP段。</li>
<li>cs:076Ch、ss:076Bh、ds:076Ah。<br>  data：076A，<br>  Stack：076B，<br>  Code：076C。</li>
<li>code段地址X，则data段地址为X-2，stack段地址为X-1。</li>
</ol>
<ol start="2">
<li>程序执行前debug -r如图：<br><img src="/imgs/20250417-11-expt5-p11.jpg"></li>
</ol>
<p>程序执行前，三个段的内容如下：<br><img src="/imgs/20250417-12-expt5-p12.jpg"><br><img src="/imgs/20250417-13-expt5-p13.jpg"></p>
<p>程序执行后，三个段的内容如下：<br><img src="/imgs/20250417-14-expt5-p14.jpg"><br><img src="/imgs/20250417-15-expt5-p15.jpg"></p>
<ol>
<li>见程序执行前的段内容截图</li>
<li>见程序执行后的段内容截图</li>
<li>code段地址X，则data段地址为X-2，stack段地址为X-1。<br>  data：076A，<br>  Stack：076B，<br>  Code：076C。<br>  虽然分配了3个段，但是每个段的长度并不一样，而是根据数据的长度灵活分配的。</li>
<li>⌈N&#x2F;16⌉*16 字节</li>
</ol>
<p>5.<br>程序执行前debug -r如图：<br><img src="/imgs/20250417-16-expt5-p16.jpg"></p>
<p>程序执行前，三个段的内容如下：<br><img src="/imgs/20250417-17-expt5-p17.jpg"><br><img src="/imgs/20250417-18-expt5-p18.jpg"></p>
<p>程序执行后，三个段的内容如下：<br><img src="/imgs/20250417-19-expt5-p19.jpg"><br><img src="/imgs/20250417-20-expt5-p20.jpg"></p>
<ol>
<li>见程序执行前的段内容截图</li>
<li>见程序执行后的段内容截图</li>
<li>code段地址X，则data段地址为X-2，stack段地址为X-1。<br>  Code：076A，<br>  data：076D，<br>  Stack：076E。</li>
</ol>
<p>这次出数据后我发现两个可疑的点，<br>1、空白（无操作）区域数据不对劲。<br>之前的实验，空白区域一般都是0，但这次不是0，有可能是因为我结束上次实验后没有重启dosbox，RAM区域里还有之前实验的数据残留。<br>2、为什么code段与data段系统分配时隔了3？<br>图中 CD:21 说明有一个段是PSP，之前教材上说PSP为256字节（p92），这里没有规定段长，可以将PSP定为一个段呀，为什么段号相隔了3？</p>
<p>带着疑问，我重启了DOSBox又来了一次，结果如下。<br>程序执行前debug -r、段的内容如下：<br><img src="/imgs/20250417-21-expt5-p21.jpg"></p>
<p>程序执行后，三个段的内容如下：<br><img src="/imgs/20250417-22-expt5-p22.jpg"><br><img src="/imgs/20250417-23-expt5-p23.jpg"></p>
<p>做完发现结论和上次一致。但是这个CD 21还是没懂，截止到这章节教材没有深入，只说CD 21 和PSP有密切联系。最后请来了deepseek答疑解惑：<br><img src="/imgs/20250417-24-expt5-p24.jpg"><br>结论如下：<br><img src="/imgs/20250417001.jpeg"><br>1、CD21即汇编指令”int 21H”在内存中存储的形式。debug中用-u即可查看。<br>2、PSP是DOS管理程序的核心数据结构，这里段号隔了3，是因为代码长度计算后需要占用3个段（3x16字节）。<br>3、​​INT 21h(CD 21)是DOS系统的核心功能调用入口</p>
<ol start="4">
<li>(3)可以正确执行，因为有没有start，程序开始执行的位置都一样。其它的执行失败，未执行到程序段中的语句，执行到了其它不知来源的语句。<br>  失败的运行结果如下图：（这里只贴了其中一个）<br>  <img src="/imgs/20250417-28-expt5-p28.jpg"><br>  成功的（3）如下图：<br>  <img src="/imgs/20250417-29-expt5-p29.jpg"></li>
</ol>
<ol start="5">
<li>写了代码，运行成功<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">assume cs:code,ds:a,ss:b,es:c</span><br><span class="line"></span><br><span class="line">a segment</span><br><span class="line">    db 1,2,3,4,5,6,7,8</span><br><span class="line">a ends</span><br><span class="line"></span><br><span class="line">b segment</span><br><span class="line">    db 1,2,3,4,5,6,7,8</span><br><span class="line">b ends</span><br><span class="line"></span><br><span class="line">c segment</span><br><span class="line">    db 0,0,0,0,0,0,0,0</span><br><span class="line">c ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line"></span><br><span class="line">start:  </span><br><span class="line">        mov bx,0</span><br><span class="line">        mov cx,8</span><br><span class="line"></span><br><span class="line">s:      mov ax,a</span><br><span class="line">        mov ds,ax</span><br><span class="line">        mov dx,ds:[bx]</span><br><span class="line"></span><br><span class="line">        mov ax,b</span><br><span class="line">        mov ss,ax</span><br><span class="line">        add dx,ss:[bx]</span><br><span class="line"></span><br><span class="line">        mov ax,c</span><br><span class="line">        mov es,ax</span><br><span class="line">        mov es:[bx],dx</span><br><span class="line">        inc bx</span><br><span class="line">        loop s</span><br><span class="line"></span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line"></span><br><span class="line">end start</span><br></pre></td></tr></table></figure>
<img src="/imgs/20250417-30-expt5-30.jpg"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line">6. 写了代码，运行成功</span><br><span class="line">```asm</span><br><span class="line">assume cs:code,ds:a,ss:b</span><br><span class="line"></span><br><span class="line">a segment</span><br><span class="line">    dw 1,2,3,4,5,6,7,8,9,0ah,0bh,0ch,0dh,0eh,0fh,0ffh</span><br><span class="line">a ends</span><br><span class="line"></span><br><span class="line">b segment</span><br><span class="line">    dw 0,0,0,0,0,0,0,0</span><br><span class="line">b ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line"></span><br><span class="line">start:  </span><br><span class="line">        mov ax,b</span><br><span class="line">        mov ss,ax</span><br><span class="line">        mov sp,16</span><br><span class="line"></span><br><span class="line">        mov bx,0</span><br><span class="line">        mov cx,8</span><br><span class="line"></span><br><span class="line">s:      mov ax,a</span><br><span class="line">        mov ds,ax</span><br><span class="line">        mov ax,ds:[bx]</span><br><span class="line">        push ax</span><br><span class="line">        add bx,2</span><br><span class="line">        loop s</span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line"></span><br><span class="line">end start</span><br></pre></td></tr></table></figure>
<img src="/imgs/20250417-31-expt5-31.jpg"></li>
</ol>
<h3 id="实验6"><a href="#实验6" class="headerlink" title="实验6"></a>实验6</h3><h4 id="实验内容-6"><a href="#实验内容-6" class="headerlink" title="实验内容"></a>实验内容</h4><p><img src="/imgs/20250418001-expt6-1.jpg"></p>
<h4 id="实验过程及结论-5"><a href="#实验过程及结论-5" class="headerlink" title="实验过程及结论"></a>实验过程及结论</h4><ol>
<li>略</li>
<li>p155-158中有关7.8的讲解很清晰，这里套用了7.8的代码。<br>解决7.9中问题的代码如下：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">assume cs:codesg,ds:datasg,ss:stacksg</span><br><span class="line"></span><br><span class="line">stacksg segment</span><br><span class="line">    dw 0,0,0,0,0,0,0,0</span><br><span class="line">stacksg ends</span><br><span class="line"></span><br><span class="line">datasg segment</span><br><span class="line">    db &#x27;1. display      &#x27;</span><br><span class="line">    db &#x27;2. brows        &#x27;</span><br><span class="line">    db &#x27;3. replaces     &#x27;</span><br><span class="line">    db &#x27;4. modify       &#x27;</span><br><span class="line">datasg ends</span><br><span class="line"></span><br><span class="line">codesg segment</span><br><span class="line">start:  mov ax,stacksg</span><br><span class="line">        mov ss,ax</span><br><span class="line">        mov sp,16</span><br><span class="line">        mov ax,datasg</span><br><span class="line">        mov ds,ax</span><br><span class="line">        mov bx,0</span><br><span class="line"></span><br><span class="line">        mov cx,4</span><br><span class="line">s0:     push cx</span><br><span class="line">        mov si,3</span><br><span class="line"></span><br><span class="line">        mov cx,4</span><br><span class="line">s:      mov al,[bx+si]</span><br><span class="line">        and al,11011111b</span><br><span class="line">        mov [bx+si],al</span><br><span class="line">        inc si</span><br><span class="line">        loop s</span><br><span class="line"></span><br><span class="line">        add bx,16</span><br><span class="line">        pop cx</span><br><span class="line">        loop s0</span><br><span class="line"></span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">codesg ends</span><br><span class="line"></span><br><span class="line">end start</span><br></pre></td></tr></table></figure>
程序执行前datasg值如下图：<br><img src="/imgs/20250418002-expt6-2.jpg"><br>程序执行后datasg值如下图：<br><img src="/imgs/20250418003-expt6-3.jpg"></li>
</ol>
<h3 id="实验7"><a href="#实验7" class="headerlink" title="实验7"></a>实验7</h3><h4 id="实验内容-7"><a href="#实验内容-7" class="headerlink" title="实验内容"></a>实验内容</h4><p><img src="/imgs/2025042301-expt7-1.jpg"><br><img src="/imgs/2025042302-expt7-2.jpg"><br><img src="/imgs/2025042303-expt7-3.jpg"></p>
<h4 id="实验过程及结论-6"><a href="#实验过程及结论-6" class="headerlink" title="实验过程及结论"></a>实验过程及结论</h4><p>最终代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line">assume ds:data,ss:stack,es:table,cs:code</span><br><span class="line">data segment</span><br><span class="line">    db &#x27;1975&#x27;,&#x27;1976&#x27;,&#x27;1977&#x27;,&#x27;1978&#x27;,&#x27;1979&#x27;,&#x27;1980&#x27;,&#x27;1981&#x27;,&#x27;1982&#x27;,&#x27;1983&#x27;,&#x27;1984&#x27;</span><br><span class="line">    db &#x27;1985&#x27;,&#x27;1986&#x27;,&#x27;1987&#x27;,&#x27;1988&#x27;,&#x27;1989&#x27;,&#x27;1990&#x27;,&#x27;1991&#x27;,&#x27;1992&#x27;,&#x27;1993&#x27;,&#x27;1994&#x27;,&#x27;1995&#x27;</span><br><span class="line">    ;以上为表示 年份 的字符串</span><br><span class="line"></span><br><span class="line">    dd 16,22,382,1356,2390,8000,16000,24486,50065,97479</span><br><span class="line">    dd 140417,197514,345980,590827,803530,1183000,1843000,2759000,3753000,4649000,5937000</span><br><span class="line">    ;以上为表示 收入 的字符串</span><br><span class="line"></span><br><span class="line">    dw 3,7,9,13,28,38,130,220,476,778</span><br><span class="line">    dw 1001,1442,2258,2793,4037,5635,8226,11542,14430,15257,17800</span><br><span class="line">    ;以上为表示 雇员数 的字符串</span><br><span class="line"></span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">stack segment</span><br><span class="line">    dw 0,0,0,0,0,0,0,0</span><br><span class="line">    ;提前申请栈空间</span><br><span class="line">stack ends</span><br><span class="line"></span><br><span class="line">table segment</span><br><span class="line">    db 21 dup(&#x27;year summ ne ?? &#x27;)</span><br><span class="line">    ;data段中数据最终要写入的数据段</span><br><span class="line"></span><br><span class="line">table ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line"></span><br><span class="line">start:  </span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line"></span><br><span class="line">    mov ax,stack</span><br><span class="line">    mov ss,ax</span><br><span class="line">    mov sp,16</span><br><span class="line"></span><br><span class="line">    mov ax,table</span><br><span class="line">    mov es,ax</span><br><span class="line"></span><br><span class="line">    mov di,0</span><br><span class="line">    mov cx,21</span><br><span class="line">    ;di：行号-1，共21行，di的最大值为20。使用di来标记当前操作的行号（或者年份），di=0为1975年，di=1为1976年，以此递推，</span><br><span class="line"></span><br><span class="line">s0: push cx</span><br><span class="line">    mov bx,0        </span><br><span class="line">    mov cx,di</span><br><span class="line"></span><br><span class="line">s1: add bx,16</span><br><span class="line">    loop s1</span><br><span class="line">    ;在table段中，不同个表结构是连续存放的，每个表结构16字节</span><br><span class="line">    ;计算当前要操作的表结构偏移地址bx,bx=di*16</span><br><span class="line"></span><br><span class="line">    mov dx,0</span><br><span class="line">    mov cx,di</span><br><span class="line">s2: add dx,4         </span><br><span class="line">    loop s2</span><br><span class="line">    </span><br><span class="line">    ;在data段中，同一个字段是连续存放的，“年份”字段每个字段占4个字节，</span><br><span class="line">    ;计算当前要操作的data段中“年份”字段偏移地址bx=di*4</span><br><span class="line">    ;先保存现有的bx值，因为等会儿其它操作需用到bx</span><br><span class="line">    ;如果把&quot;push bx&quot;放到复制年份的循环中，栈不平衡（push少pop多），</span><br><span class="line">    ;为了栈平衡，这里做了改动，ds段的偏移值计算出后先用dx存储（因为dx暂时用不到，其它x类寄存器要用到），到循环中后再对bx进行push、pop操作</span><br><span class="line"></span><br><span class="line">    mov cx,4</span><br><span class="line">    mov si,0       </span><br><span class="line">    ;“年份”字段是用db定义的，每个字段有4个字节，每次操作1个字节，用al，每个字段需重复操作4次，cx=4</span><br><span class="line">s3: push bx</span><br><span class="line">    mov bx,dx</span><br><span class="line">    mov al,ds:[bx].0h[si]  </span><br><span class="line">    pop bx</span><br><span class="line">    mov byte ptr es:[bx].0h[si],al</span><br><span class="line">    inc si</span><br><span class="line">    loop s3</span><br><span class="line"></span><br><span class="line">    ;复制年份</span><br><span class="line">    ;es:[bx].0h[si]， 其中 bx：table不同行的基址，                             0h：该行中不同字段的基址，        si：该字段中不同字符的基址</span><br><span class="line">    ;ds:[bx].54h[si]，其中 bx：di x 字段长度，某字段连续空间中该字段不同行的基址  0h：不同字段连续空间的基址，      si：该字段中不同字符的基址</span><br><span class="line"></span><br><span class="line">    push bx</span><br><span class="line">    mov bx,0</span><br><span class="line">    mov cx,di</span><br><span class="line">s4:add bx,4         </span><br><span class="line">    loop s4</span><br><span class="line">    ;“收入”字段是用dd定义的，每个字段占了2个字，4个字节，每次操作1个字（2字节），用2个寄存器，每个字段需操作1次</span><br><span class="line"> </span><br><span class="line">    mov ax,ds:[bx].54h[0]</span><br><span class="line">    mov dx,ds:[bx].54h[2] </span><br><span class="line">    pop bx</span><br><span class="line">    mov word ptr es:[bx].5h[0],ax</span><br><span class="line">    mov word ptr es:[bx].5h[2],dx</span><br><span class="line">    ;复制收入</span><br><span class="line"></span><br><span class="line">    push bx</span><br><span class="line">    mov bx,0</span><br><span class="line">    mov cx,di</span><br><span class="line">s5: add bx,2        </span><br><span class="line">    loop s5</span><br><span class="line">    ;“雇员数”字段是用dw定义的，每个字段占了2个字节，每次操作1个字（2字节），用1个寄存器，每个字段需操作1次</span><br><span class="line">    ;计算当前要操作的data段中“年份”字段偏移地址bx=di*2</span><br><span class="line"></span><br><span class="line">    mov ax,ds:[bx].0a8h</span><br><span class="line">    pop bx</span><br><span class="line">    mov word ptr es:[bx].0ah,ax</span><br><span class="line">    ;复制雇员数</span><br><span class="line"></span><br><span class="line">    ;人均收入=收入/雇员数，被除数4字节，用dx存高位，ax存低位，除数2字节，用bx存储，商存到ax中，余数存到dx中</span><br><span class="line">    mov dx,es:[bx].7h</span><br><span class="line">    mov ax,es:[bx].5h</span><br><span class="line">    mov cx,es:[bx].0ah</span><br><span class="line">    div cx</span><br><span class="line">    mov word ptr  es:[bx].0dh,ax</span><br><span class="line">    ;依次计算人均收入并填入</span><br><span class="line"></span><br><span class="line">    inc di</span><br><span class="line">    pop cx</span><br><span class="line">    loop s0</span><br><span class="line">    </span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line">end start</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>结果图<br><img src="/imgs/2025042304-expt7-4.jpg"></p>
<p>在完成该实验的过程中犯了很多大大小小的错误哈哈哈，将犯了错的知识点总结如下：<br>1.数据类型与空间大小对应<br>data段中定义数据时，使用db、dw、dd定义的数据类型大小各不同，在对数据进行复制时需注意按照数据类型进行指定操作，<br>如：db定义的是byte，1字节，dw定义的是word，2字节，dd定义的是dword，4字节。<br>在进行复制操作时，db需用半个寄存器，比如al、ah等，dw需用1个寄存器，如ax、bx等，dd需用两个寄存器。<br>从寄存器➡内存地址时，需指定类型，这样系统才知道要复制多少个字节；<br>从内存地址➡寄存器时，不需指定，因为默认会按寄存器复制相应的数据，如al复制1个字节，ax则复制2个字节。</p>
<p>2.栈使用<br>使用栈操作push、pop时，需注意“栈平衡”，不然值可能不是你想要的，操作时细心一些就好。</p>
<p>3.使用灵活的定位内存地址方法时，注意只有特定寄存器（bx、si、di、bp）才能进行定位操作，且需注意每个寄存器的特点。</p>
<p>4.除法操作，需注意不同位数下被除数、除数、商、余数的存放位置。</p>
<h3 id="实验8"><a href="#实验8" class="headerlink" title="实验8"></a>实验8</h3><h4 id="实验内容-8"><a href="#实验内容-8" class="headerlink" title="实验内容"></a>实验内容</h4><p><img src="/imgs/2025042305-expt8-1.jpg"></p>
<h4 id="实验过程及结论-7"><a href="#实验过程及结论-7" class="headerlink" title="实验过程及结论"></a>实验过程及结论</h4><p><img src="/imgs/2025042308-expt8-2.jpg"><br>程序可以正确返回，运行过程如下：<br>（为了方便叙述，采用上图中的行号）<br>程序开始，运行到r5（第5行，后面也这样写，实际这里是cs:00）<br>r6 无操作<br>r7 无操作<br>r8 将s的偏移地址赋给di<br>r9 将s2的偏移地址赋给si<br>r10 将s2指向的代码赋给ax<br>r11 将ax的值赋给s所在位置，即第6行所在位置<br>r12 段内短转移至s位置，此时s位置为 jmp short s1.因为jmp short XXX语句记录的相对位移。<br>在s2处的jmp short s1，相对位移是address(s1)-address(s2)，这里位移是上移3位（-3）<br>。此时该语句在s位置，s位置上移3位就是r3的mov ax,4c00h。<br>从这里开始执行，最后执行为int 21h，程序结束。可将代码编译、链接为.exe文件进行debug调试，在执行到r12，后面是r6，执行完r6之后，直接就是r3，ax没被置为0，被置为了正常退出的值4c00h。<br><img src="/imgs/2025042309-expt8-3.jpg"></p>
<h3 id="实验9"><a href="#实验9" class="headerlink" title="实验9"></a>实验9</h3><h4 id="实验内容-9"><a href="#实验内容-9" class="headerlink" title="实验内容"></a>实验内容</h4><p><img src="/imgs/2025042305-expt8-1.jpg"><br><img src="/imgs/2025042306-expt9-1.jpg"><br><img src="/imgs/2025042307-expt9-2.jpg"></p>
<h4 id="实验过程及结论-8"><a href="#实验过程及结论-8" class="headerlink" title="实验过程及结论"></a>实验过程及结论</h4><p>根据实验描述，编辑代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">assume cs:code,ds:data</span><br><span class="line">data segment</span><br><span class="line">db &#x27;HELLO DOSBOX!&#x27;</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax, 0B800h</span><br><span class="line">    mov es, ax</span><br><span class="line">    mov di, (12 * 80 + 35)*2  </span><br><span class="line">    ;第12行第35列（居中）</span><br><span class="line"></span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    mov si,0</span><br><span class="line">    mov cx,13</span><br><span class="line">s:  </span><br><span class="line">    mov al,ds:[si]</span><br><span class="line">    inc si</span><br><span class="line">    mov es:[di],al</span><br><span class="line">    mov byte ptr es:[di+1], 0cah</span><br><span class="line">    add di,2</span><br><span class="line">    loop s</span><br><span class="line"></span><br><span class="line">    mov ax, 4C00h</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>
<p>这里我的内容没有和书上一样，而是改成了”HELLO DOSBOX!”，效果图如下：<br><img src="/imgs/2025042309-expt8-3.jpg"><br><img src="/imgs/2025042310-expt9-4.gif"></p>
<h3 id="实验10"><a href="#实验10" class="headerlink" title="实验10"></a>实验10</h3><h4 id="实验内容-10"><a href="#实验内容-10" class="headerlink" title="实验内容"></a>实验内容</h4><p><img src="/imgs/2025042401.jpg"><br><img src="/imgs/2025042402.jpg"><br><img src="/imgs/2025042403.jpg"><br><img src="/imgs/2025042404.jpg"><br><img src="/imgs/2025042405.jpg"><br><img src="/imgs/2025042406.jpg"><br><img src="/imgs/2025042407r.jpg"></p>
<h4 id="实验过程及结论-9"><a href="#实验过程及结论-9" class="headerlink" title="实验过程及结论"></a>实验过程及结论</h4><ol>
<li><p>显示字符串<br>这里由于之前都写过相关的函数，所以没花多少时间。<br>显示屏幕大小80x25字，显存段地址0B800h，偏移从0开始。且题目规定行号范围（0<del>79），列号范围（0</del>24），<br>因此，X行Y列在显存中的偏移量（字节）就是(80*+Y)*2。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">assume cs:code,ds:data</span><br><span class="line">data segment</span><br><span class="line">db &#x27;Welcome to masm!&#x27;,0</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:  </span><br><span class="line">    mov dh,79</span><br><span class="line">    ;行数</span><br><span class="line"></span><br><span class="line">    mov dl,3</span><br><span class="line">    ;列号</span><br><span class="line"></span><br><span class="line">    mov cl,2</span><br><span class="line">    ;属性值</span><br><span class="line"></span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    mov si,0</span><br><span class="line">    call show_str</span><br><span class="line">    mov ax, 4C00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">show_str:</span><br><span class="line">    push ax</span><br><span class="line">    push bx</span><br><span class="line">    push cx</span><br><span class="line">    push dx</span><br><span class="line">    push di</span><br><span class="line">    push si</span><br><span class="line"></span><br><span class="line">    mov ax, 0B800h</span><br><span class="line">    mov es, ax</span><br><span class="line"></span><br><span class="line">    ;显示屏幕大小80x25字</span><br><span class="line">    ;因此，X行Y列在显存中的偏移量（字节）就是(80*(X-1)+Y)*2=(80X+Y-80)*2</span><br><span class="line">    ;修正，因为行号、列号范围都是从0开始，所以不需要再减1。而且上一个公式，就算行号不减1，列号也应该减，公式错误。</span><br><span class="line">    ;公式更新为：(80*X+Y)*2</span><br><span class="line"></span><br><span class="line">    mov al,80</span><br><span class="line">    mul dh</span><br><span class="line">    ;ax=al*dh,ax=80x行号</span><br><span class="line"></span><br><span class="line">    mov bl,dl</span><br><span class="line">    mov bh,0h</span><br><span class="line">    ;为了可以在寄存器计算，将列号扩充到bx中计算</span><br><span class="line"></span><br><span class="line">    add ax,bx</span><br><span class="line">    add ax,ax</span><br><span class="line">    ;计算完成后，起始位置（即在显存中的偏移量，单位字节）存到了ax中</span><br><span class="line"></span><br><span class="line">    mov di,ax</span><br><span class="line">    mov si,0</span><br><span class="line">    mov bl,cl</span><br><span class="line">    ;等会儿的循环中需要用cx，所以cl的值放到bl中</span><br><span class="line">write_into:</span><br><span class="line">    mov cl,ds:[si]</span><br><span class="line">    mov ch,0</span><br><span class="line">    ;cl存储字符的ASCII值，bl中存储属性（颜色）值</span><br><span class="line"></span><br><span class="line">    jcxz ok</span><br><span class="line">    mov es:[di],cl</span><br><span class="line">    mov byte ptr es:[di+1], bl</span><br><span class="line">    add di,2</span><br><span class="line">    inc si</span><br><span class="line">    jmp short write_into</span><br><span class="line"></span><br><span class="line">ok: pop si</span><br><span class="line">    pop di</span><br><span class="line">    pop dx</span><br><span class="line">    pop cx</span><br><span class="line">    pop bx</span><br><span class="line">    pop ax</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">code ends</span><br><span class="line">end start</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>实际代码实现后发现个问题，dosbox这显示应该是吞了一行。<br>行数1列数3显示如下：<br><img src="/imgs/2025042408.jpg"><br>行数80列数3显示如下：<br><img src="/imgs/2025042409.jpg"></p>
</li>
<li><p>解除除法溢出的问题<br>最终代码如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line">assume cs:code,ss:stack</span><br><span class="line">stack segment</span><br><span class="line">dw 0,0,0,0,0,0,0,0,0,0</span><br><span class="line">stack ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:  </span><br><span class="line">    mov ax,stack</span><br><span class="line">    mov ss,ax</span><br><span class="line">    mov sp,20</span><br><span class="line"></span><br><span class="line">    mov ax,4240h</span><br><span class="line">    mov dx,000fh</span><br><span class="line">    mov cx,0ah</span><br><span class="line">    call divdw</span><br><span class="line"></span><br><span class="line">    mov ax, 4C00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">    ;divdw参数：</span><br><span class="line">    ;ax: dd型数据低16位</span><br><span class="line">    ;dx: dd型数据高16位</span><br><span class="line">    ;cx: 除数</span><br><span class="line">    ;返回：</span><br><span class="line">    ;dx:结果高16位，ax:结果低16位，cx:余数</span><br><span class="line"></span><br><span class="line">    ;div除法指令规则</span><br><span class="line">    ;被除数16位，除数8位：被除数ax，除数 (含8位及以内有效数值)寄存器，商al，余数ah</span><br><span class="line">    ;被除数32位，除数16位：被除数高位dx，低位ax，除数 (含16位及以内有效数值)寄存器，商ax，余数dx</span><br><span class="line">    ;需优化，最后位数由除数决定，而不是被除数，逻辑错误</span><br><span class="line">    ;由于最后需要输出32位的数据，所以需要再用一个寄存器，这里引用了和bx类似的si，但是si不可以分为高低9位</span><br><span class="line"></span><br><span class="line">    ;mul乘法指令法则</span><br><span class="line">    ;两个相乘的数，位数需一致</span><br><span class="line">    ;8位:两个乘数一个在al中，另一个在8位reg或内存字节单元中，结果在ax中</span><br><span class="line">    ;16位:两个乘数个在ax中，另一个在16位reg或内存字节单元中，结果高位dx，低位ax</span><br><span class="line"></span><br><span class="line">divdw:</span><br><span class="line">    push bx</span><br><span class="line">    push si</span><br><span class="line"></span><br><span class="line">    push ax</span><br><span class="line">    push cx</span><br><span class="line">    push dx</span><br><span class="line">    </span><br><span class="line">    ;因参数及返回中未用到bx，因此用bx存储结果,修改：因为需返回32位，所以用bx+si返回，bx存储高位，si存储低位</span><br><span class="line">    ;计算int(H/N)</span><br><span class="line">    mov ax,dx</span><br><span class="line">    mov dx,0</span><br><span class="line">    div cx</span><br><span class="line"></span><br><span class="line">    ;商的结果在ax中</span><br><span class="line">    ;65536b=10000h，</span><br><span class="line">    ;因为乘数已超4位（即二进制16位），mul指令最多为16*16位，所以不能使用mul指令，改为 使用加法代替乘法</span><br><span class="line">    ;因为商和余数都不可能大于16位（本质的原因是因为被除数不可能超过32位），所以不用考虑值最后超过32位的情况</span><br><span class="line">    ;又因为cx最多为16位（二进制），所以先加一次再进行循环</span><br><span class="line">    ;最终修改的版本为：因为X10000h，相当二进制左移16位，所以这里直接低位数值变高位数值，低位变0</span><br><span class="line"></span><br><span class="line">    mov dx,ax</span><br><span class="line">    mov ax,0</span><br><span class="line">    ;int(H/N)*65536的值，高位存到dx中，低位存到ax中</span><br><span class="line"></span><br><span class="line">    mov bx,dx</span><br><span class="line">    mov si,ax</span><br><span class="line">    ;将int(H/N)*65536的值放到bx+si中</span><br><span class="line"></span><br><span class="line">    pop dx</span><br><span class="line">    pop cx</span><br><span class="line">    pop ax</span><br><span class="line">    ;上面的计算已改变保存divdw参数的寄存器值，使用recv把原来的值恢复</span><br><span class="line"></span><br><span class="line">    push bx</span><br><span class="line">    push si</span><br><span class="line">    ;由于接下来的运算需要到ax、dx、cx寄存器，而参数也是存在这些寄存器中，需要再次拿bx、si作数据周转</span><br><span class="line">    ;因此用栈保存现在bx+si的值，即int(H/N)*65536的值</span><br><span class="line"></span><br><span class="line">    mov bx,0</span><br><span class="line">    mov si,ax</span><br><span class="line">    ;接下来的运算要用到ax寄存器，所以先保存公式中的L参数。又因为L涉及到32位运算，所以使用bx+si存储L，bx存储高位，si存储低位</span><br><span class="line"></span><br><span class="line">    ;计算rem(H/N),取余数</span><br><span class="line">    mov ax,dx</span><br><span class="line">    mov dx,0</span><br><span class="line">    div cx</span><br><span class="line">    ;余数的结果在dx中</span><br><span class="line"></span><br><span class="line">    mov ax,0</span><br><span class="line">    ;计算rem(H/N)*65536,和计算int(H/N)类似，不再赘述使用加法代替乘法的原因</span><br><span class="line">    ;通过搜索确定了32位加法中处理进位的方法：低位用add，高位用adc</span><br><span class="line">    ;再次修改，因65536十六进制为5位，且65536=256^2，所以一次乘法拆为两次</span><br><span class="line">    ;循环完成后，rem(H/N)*65536的值，高位存到dx中，低位存到ax中</span><br><span class="line">    </span><br><span class="line">    add ax,si</span><br><span class="line">    adc dx,bx</span><br><span class="line"></span><br><span class="line">    ;计算rem(H/N)*65536+L,L的值之前已经存到bx+si中，</span><br><span class="line">    ;操作完成后，rem(H/N)*65536+L的值高位存到dx，低位ax</span><br><span class="line"></span><br><span class="line">    div cx</span><br><span class="line">    ;计算[rem(H/N)*65536+L]/N，商ax，余数dx，在整个公式中，因为int(H/N)*65536低16位为0，所以此时计算出的余数dx即为X/N的余数</span><br><span class="line">    </span><br><span class="line">    pop si</span><br><span class="line">    pop bx</span><br><span class="line">    ;恢复int(H/N)*65536的值到bx+si中</span><br><span class="line"></span><br><span class="line">    push dx </span><br><span class="line">    ;将X/N余数压栈</span><br><span class="line"></span><br><span class="line">    mov dx,0</span><br><span class="line">    add ax,si</span><br><span class="line">    adc dx,bx</span><br><span class="line">    ;之前int(H/N)*65536的结果存到了 bx：高位，si：低位 中</span><br><span class="line">    ;计算int(H/N)*65536+[rem(H/N)*65536+L]/N</span><br><span class="line">    ;最终公式的值存到高位dx，低位ax中</span><br><span class="line"></span><br><span class="line">    pop cx</span><br><span class="line">    ;余数的值赋给cx</span><br><span class="line"></span><br><span class="line">    pop si</span><br><span class="line">    pop bx</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line">;prtc:</span><br><span class="line">    ;push ax</span><br><span class="line">    ;push cx</span><br><span class="line">    ;push dx</span><br><span class="line">    ;ret</span><br><span class="line">;recv:</span><br><span class="line">    ;pop dx</span><br><span class="line">    ;pop cx</span><br><span class="line">    ;pop ax</span><br><span class="line">    ;ret</span><br><span class="line">    ;因为call指令本质上相当于</span><br><span class="line">    ;&quot;push IP</span><br><span class="line">    ; jmp near ptr 标号&quot;指令，所以这类需要修改，因为prtc中栈不平衡。</span><br><span class="line">    ;按我刚开始的代码，本来想着使用call指令尽量减少重复代码，但后来发现栈不平衡，且代码优化后并没有重复很多次，所以废弃了用call调用这几个栈命令的想法</span><br><span class="line"></span><br><span class="line">code ends</span><br><span class="line">end start</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>实现的过程中发现一些错误，错误及原因、订正方案如下：</p>
</li>
</ol>
<ol>
<li>某数乘以65536，就相当于二进制数左移16位，用这个角度理解是最方便的，且很直观知道int(H&#x2F;N)*65536除以16位的数，余数为0。<br>  因为65536b&#x3D;1000h，所以刚开始想的是分两步乘，但走到第二步时发现是32位X32位了，遂放弃。</li>
<li>在使用call+ret组合时，忽略了call指令本质上相当于”push IP;jmp near ptr 标号”指令，需要在call的“函数”中保持栈平衡。<br>因为不知道这点，所以想着用call节省”push XXX”这类的语句，未考虑栈平衡。</li>
<li>因为使用div&#x2F;mul指令时有很多细节，比如位数和指定的寄存器等，所以直接把规则写成注释放代码里了，方便看。</li>
</ol>
<p>debug截图如下：<br><img src="/imgs/2025042601.jpg"><br><img src="/imgs/2025042602.jpg"></p>
<ol start="3">
<li>数值显示<br>  将内存中的数值输出到屏幕上的函数之前已经写过，这个子程序难点主要是处理字符串。处理的步骤在教材中已经给出，这里不再赘述。<br>  代码如下：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line">assume cs:code,ds:data,ss:stack,es:data1</span><br><span class="line">data segment</span><br><span class="line">dw 123,12666,1,8,3,38,20,13,2</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">data1 segment</span><br><span class="line">db 32 dup(0)</span><br><span class="line">data1 ends</span><br><span class="line"></span><br><span class="line">stack segment</span><br><span class="line">dw 8 dup(0)</span><br><span class="line">stack ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:  </span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line"></span><br><span class="line">    mov ax,stack</span><br><span class="line">    mov ss,ax</span><br><span class="line">    mov sp,8</span><br><span class="line"></span><br><span class="line">    mov ax,data1</span><br><span class="line">    mov es,ax</span><br><span class="line"></span><br><span class="line">    mov di,0</span><br><span class="line">    mov si,0</span><br><span class="line"></span><br><span class="line">s0: mov ax,ds:[si]</span><br><span class="line">    mov dx,0</span><br><span class="line">    mov bx,0</span><br><span class="line">    ;待补充pop计数</span><br><span class="line"></span><br><span class="line">    mov cx,ax</span><br><span class="line">    jcxz ok1</span><br><span class="line">    ;判断是否为ds段中的结束标记，如果是，直接开始ok1：显示到屏幕上</span><br><span class="line"></span><br><span class="line">s1: mov dx,0</span><br><span class="line">    mov cx,10</span><br><span class="line">    div cx</span><br><span class="line">    ;divdw指令执行后，余数保存在dx中，商保存在ax中</span><br><span class="line"></span><br><span class="line">    mov cx,ax</span><br><span class="line">    ;将商的值放到cx中</span><br><span class="line"></span><br><span class="line">    add dx,30H</span><br><span class="line">    ;计算余数的值的ASCII值</span><br><span class="line"></span><br><span class="line">    push dx</span><br><span class="line">    ;把余数的ASCII值压栈</span><br><span class="line"></span><br><span class="line">    inc bx</span><br><span class="line">    mov cx,ax</span><br><span class="line">    jcxz ok0</span><br><span class="line">    ;判断商的值是否为0，如果为0，开始ok0部分</span><br><span class="line"></span><br><span class="line">    mov ax,cx</span><br><span class="line">    jmp short s1</span><br><span class="line"></span><br><span class="line">ok0:mov cx,bx</span><br><span class="line">s2: pop ax</span><br><span class="line">    ;前面已经判断过需要转换的值是否为0，</span><br><span class="line">    ;这里到ok行的，都是值不为0的，栈中肯定有数据</span><br><span class="line"></span><br><span class="line">    mov byte ptr es:[di],al</span><br><span class="line">    inc di</span><br><span class="line">    loop s2</span><br><span class="line"></span><br><span class="line">    mov al,20H</span><br><span class="line">    ;每个数字写入es段后增加空格，空格的ASCII值为32b=20H</span><br><span class="line"></span><br><span class="line">    mov byte ptr es:[di],al</span><br><span class="line">    inc di</span><br><span class="line">    add si,2</span><br><span class="line">    jmp short s0</span><br><span class="line"></span><br><span class="line">ok1:</span><br><span class="line">    mov dh,8</span><br><span class="line">    ;行数</span><br><span class="line">    mov dl,3</span><br><span class="line">    ;列号</span><br><span class="line">    mov cl,2</span><br><span class="line">    ;属性值</span><br><span class="line">    </span><br><span class="line">    mov ax,data1</span><br><span class="line">    mov ds,ax</span><br><span class="line">    mov si,0</span><br><span class="line">    call show_str</span><br><span class="line">    mov ax, 4C00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">show_str:</span><br><span class="line">    push ax</span><br><span class="line">    push bx</span><br><span class="line">    push cx</span><br><span class="line">    push dx</span><br><span class="line">    push di</span><br><span class="line">    push si</span><br><span class="line"></span><br><span class="line">    mov ax, 0B800h</span><br><span class="line">    mov es, ax</span><br><span class="line"></span><br><span class="line">    ;显示屏幕大小80x25字</span><br><span class="line">    ;因此，X行Y列在显存中的偏移量（字节）就是(80*(X-1)+Y)*2=(80X+Y-80)*2</span><br><span class="line">    ;修正，因为行号、列号范围都是从0开始，所以不需要再减1。而且上一个公式，就算行号不减1，列号也应该减，公式错误。</span><br><span class="line">    ;公式更新为：(80*X+Y)*2</span><br><span class="line"></span><br><span class="line">    mov al,80</span><br><span class="line">    mul dh</span><br><span class="line">    ;ax=al*dh,ax=80x行号</span><br><span class="line"></span><br><span class="line">    mov bl,dl</span><br><span class="line">    mov bh,0h</span><br><span class="line">    ;为了可以在寄存器计算，将列号扩充到bx中计算</span><br><span class="line"></span><br><span class="line">    add ax,bx</span><br><span class="line">    add ax,ax</span><br><span class="line">    ;计算完成后，起始位置（即在显存中的偏移量，单位字节）存到了ax中</span><br><span class="line"></span><br><span class="line">    mov di,ax</span><br><span class="line">    mov si,0</span><br><span class="line">    mov bl,cl</span><br><span class="line">    ;等会儿的循环中需要用cx，所以cl的值放到bl中</span><br><span class="line">write_into:</span><br><span class="line">    mov cl,ds:[si]</span><br><span class="line">    mov ch,0</span><br><span class="line">    ;cl存储字符的ASCII值，bl中存储属性（颜色）值</span><br><span class="line"></span><br><span class="line">    jcxz ok</span><br><span class="line">    mov es:[di],cl</span><br><span class="line">    mov byte ptr es:[di+1], bl</span><br><span class="line">    add di,2</span><br><span class="line">    inc si</span><br><span class="line">    jmp short write_into</span><br><span class="line"></span><br><span class="line">ok: pop si</span><br><span class="line">    pop di</span><br><span class="line">    pop dx</span><br><span class="line">    pop cx</span><br><span class="line">    pop bx</span><br><span class="line">    pop ax</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">code ends</span><br><span class="line">end start</span><br><span class="line"></span><br></pre></td></tr></table></figure>
程序执行结果如下：<br><img src="/imgs/2025042801.jpg"></li>
</ol>
<h3 id="实验11"><a href="#实验11" class="headerlink" title="实验11"></a>实验11</h3><h4 id="实验内容-11"><a href="#实验内容-11" class="headerlink" title="实验内容"></a>实验内容</h4><p><img src="/imgs/2025042802.jpg"><br><img src="/imgs/2025042803.jpg"></p>
<h4 id="实验过程及结论-10"><a href="#实验过程及结论-10" class="headerlink" title="实验过程及结论"></a>实验过程及结论</h4><p>这个实验相对比较简单，重点是cmp、jXXX语句的使用，代码如下，过程不再赘述。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">assume cs:codesg</span><br><span class="line">datasg segment</span><br><span class="line">    db &quot;Beginner&#x27;s All-purpose Symbolic Instruction Code.&quot;,0</span><br><span class="line">datasg ends</span><br><span class="line"></span><br><span class="line">stack segment</span><br><span class="line">    dw 0,0,0,0,0,0,0,0</span><br><span class="line">stack ends</span><br><span class="line"></span><br><span class="line">codesg segment</span><br><span class="line">begin:</span><br><span class="line">    mov ax,stack</span><br><span class="line">    mov ss,ax</span><br><span class="line">    mov sp,16</span><br><span class="line">    </span><br><span class="line">    mov ax,datasg</span><br><span class="line">    mov ds,ax</span><br><span class="line">    mov si,0</span><br><span class="line">    call letterc</span><br><span class="line"></span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">letterc:</span><br><span class="line">    push ax</span><br><span class="line">    push si</span><br><span class="line">    push ds</span><br><span class="line">    mov si,0</span><br><span class="line">    </span><br><span class="line">s2: mov al,ds:[si]</span><br><span class="line">    mov ah,0</span><br><span class="line">    cmp ax,0</span><br><span class="line">    je s0</span><br><span class="line">    ;遇到结束标识符0则直接结束</span><br><span class="line"></span><br><span class="line">    cmp ax,61h</span><br><span class="line">    jb s1</span><br><span class="line">    cmp ax,7ah</span><br><span class="line">    ja s1</span><br><span class="line">    ;根据小写字母ASCII值范围筛选小写字母</span><br><span class="line"></span><br><span class="line">    sub ax,20h</span><br><span class="line">    ;如果是小写字母，则ASCII值减少20h，变为大写</span><br><span class="line">    mov byte ptr ds:[si],al</span><br><span class="line">s1: inc si</span><br><span class="line">    jmp s2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s0: pop ds</span><br><span class="line">    pop si</span><br><span class="line">    pop ax</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line">codesg ends</span><br><span class="line">end begin</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>程序执行效果如下：<br><img src="/imgs/2025042804.jpg"></p>
<h3 id="实验12"><a href="#实验12" class="headerlink" title="实验12"></a>实验12</h3><h4 id="实验内容-12"><a href="#实验内容-12" class="headerlink" title="实验内容"></a>实验内容</h4><p><img src="/imgs/2025050601.jpg"></p>
<h4 id="实验过程及结论-11"><a href="#实验过程及结论-11" class="headerlink" title="实验过程及结论"></a>实验过程及结论</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">assume cs:code</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    ;将do0代码复制到0:200处</span><br><span class="line">    mov ax,cs</span><br><span class="line">    mov ds,ax</span><br><span class="line">    mov si,offset do0   ;设置ds:si指向源地址</span><br><span class="line">    mov ax,0</span><br><span class="line">    mov es,ax</span><br><span class="line">    mov di,200h     ;设置es:di指向目的地址</span><br><span class="line">    mov cx,offset do0end-offset do0     ;设置cx为传输长度</span><br><span class="line">    cld     ;设置传输方向为正</span><br><span class="line">    rep movsb</span><br><span class="line"></span><br><span class="line">    ;设置中断向量表</span><br><span class="line">    mov ax,0</span><br><span class="line">    mov es,ax</span><br><span class="line">    mov word ptr es:[0*4],200h</span><br><span class="line">    mov word ptr es:[0*4+2],0</span><br><span class="line"></span><br><span class="line">    mov ax,1000h</span><br><span class="line">    mov bh,1</span><br><span class="line">    div bh</span><br><span class="line">    </span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line"></span><br><span class="line">do0:jmp short do0start</span><br><span class="line">    db &quot;divide error!&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">do0start:  </span><br><span class="line">    ;显示字符串&quot;divide error!&quot;</span><br><span class="line">    mov ax,cs</span><br><span class="line">    mov ds,ax</span><br><span class="line">    mov si,202h</span><br><span class="line"></span><br><span class="line">    mov ax,0b800h</span><br><span class="line">    mov es,ax</span><br><span class="line">    mov di,12*160+36*2</span><br><span class="line"></span><br><span class="line">    mov cx,13    ;设置cx为传输长度，即字符长度</span><br><span class="line">s:  mov al,[si]</span><br><span class="line">    mov es:[di],al</span><br><span class="line">    mov al,1eh  ;字体属性值：蓝底黄字</span><br><span class="line">    mov es:[di+1],al</span><br><span class="line">    inc si</span><br><span class="line">    add di,2</span><br><span class="line">    loop s</span><br><span class="line"></span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h </span><br><span class="line">do0end:</span><br><span class="line">    nop</span><br><span class="line"></span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>
<p>代码执行效果如下：<br><img src="/imgs/2025050301.jpg"></p>
<p>在一开始测试0号中断时发现中断程序有些问题，测试的代码如下（除以0会触发0号中断）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">assume cs:code;ss:stack</span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,1000h</span><br><span class="line">    mov bh,0</span><br><span class="line">    div bh</span><br><span class="line">    </span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>
<p>执行后结果如下图所示：<br><img src="/imgs/2025050304.jpg"><br>使用debug查看0000:0000（存放中断向量表的位置），然后查看前两个中断向量及相应的中断程序，<br>发现和刚才测试的代码一致，还发现了中断返回指令”iret”，如下图所示：<br><img src="/imgs/2025050302.jpg"><br><img src="/imgs/2025050303.jpg"><br>这说明，dosbox是模拟了中断过程的，且中断向量的存放地址就是放在默认的0000:0000，但是中断程序没有模拟，只有几行意义不明的语句。<br>因为“探测中断-中断触发-寻找中断向量-执行中断程序”的链条中，只有中断程序没模拟，所以只要我们把自定义中断程序并将其放到指定的内存位置，那么实验12就可以顺利完成。</p>
<p>_____________模板</p>
<h3 id="实验13"><a href="#实验13" class="headerlink" title="实验13"></a>实验13</h3><h4 id="实验内容-13"><a href="#实验内容-13" class="headerlink" title="实验内容"></a>实验内容</h4><p><img src="/imgs/2025050602.jpg"><br><img src="/imgs/2025050603.jpg"><br><img src="/imgs/2025050604.jpg"></p>
<h4 id="实验过程及结论-12"><a href="#实验过程及结论-12" class="headerlink" title="实验过程及结论"></a>实验过程及结论</h4><p>实验13的3个子实验难度不大，子程序都可在该章中找到代码，实验详细过程不再赘述。</p>
<ol>
<li>代码如下<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">assume cs:code</span><br><span class="line">code segment</span><br><span class="line"></span><br><span class="line">start:</span><br><span class="line">    mov ax,cs</span><br><span class="line">	mov ds,ax</span><br><span class="line">	mov si,offset show_str</span><br><span class="line">	mov ax,0</span><br><span class="line">	mov es,ax</span><br><span class="line">	mov di,200h</span><br><span class="line">	mov cx,offset show_str_end - offset show_str</span><br><span class="line">	cld</span><br><span class="line">	rep movsb</span><br><span class="line"></span><br><span class="line">	mov ax,0</span><br><span class="line">	mov es,ax</span><br><span class="line">	mov word ptr es:[7ch*4],200h</span><br><span class="line">	mov word ptr es:[7ch*4+2],0</span><br><span class="line"></span><br><span class="line">	mov ax,4c00h</span><br><span class="line">	int 21h</span><br><span class="line"></span><br><span class="line">show_str:  </span><br><span class="line">    ;显示字符串</span><br><span class="line">    ;参数：dh=行号，dl=列号，cl=颜色，ds:si指向字符串首地址</span><br><span class="line"></span><br><span class="line">    push ax</span><br><span class="line">    push cx</span><br><span class="line">    push dx</span><br><span class="line">    push ds</span><br><span class="line">    push es</span><br><span class="line">    push si</span><br><span class="line">    push di</span><br><span class="line"></span><br><span class="line">    mov ax,0b800h</span><br><span class="line">    mov es,ax</span><br><span class="line">    ;起始位置为(80*X+Y)*2，X为行号，Y为列号</span><br><span class="line">    ;使用加法代替乘法</span><br><span class="line">    ;（此处仅考虑一页，即一个屏幕大小的区域）</span><br><span class="line">    ;因为最大行号为25，最大列号80，25*160+80*2=4160，2^9=512,所以需要16位寄存器表示</span><br><span class="line">    mov al,160</span><br><span class="line">    mul dh</span><br><span class="line">    ;dh*160的值存到ax中</span><br><span class="line">    mov dh,0</span><br><span class="line">    add dx,dx</span><br><span class="line">    add ax,dx</span><br><span class="line">    ;ax=(80*X+Y)*2</span><br><span class="line"></span><br><span class="line">    mov di,ax</span><br><span class="line">    </span><br><span class="line">s:  mov al,ds:[si]</span><br><span class="line">    cmp al,0</span><br><span class="line">    je ok</span><br><span class="line">    mov es:[di],al</span><br><span class="line">    mov es:[di+1],cl</span><br><span class="line">    inc si</span><br><span class="line">    add di,2</span><br><span class="line">    jmp s</span><br><span class="line">    </span><br><span class="line">ok: </span><br><span class="line">    pop di</span><br><span class="line">    pop si</span><br><span class="line">    pop es</span><br><span class="line">    pop ds</span><br><span class="line">    pop dx</span><br><span class="line">    pop cx</span><br><span class="line">    pop ax</span><br><span class="line">    iret</span><br><span class="line">show_str_end:</span><br><span class="line">    nop</span><br><span class="line"></span><br><span class="line">code ends</span><br><span class="line">end start</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>代码如下<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">assume cs:code</span><br><span class="line">code segment</span><br><span class="line"></span><br><span class="line">start:</span><br><span class="line">    mov ax,cs</span><br><span class="line">	mov ds,ax</span><br><span class="line">	mov si,offset lp</span><br><span class="line">	mov ax,0</span><br><span class="line">	mov es,ax</span><br><span class="line">	mov di,200h</span><br><span class="line">	mov cx,offset lp_end - offset lp</span><br><span class="line">	cld</span><br><span class="line">	rep movsb</span><br><span class="line"></span><br><span class="line">	mov ax,0</span><br><span class="line">	mov es,ax</span><br><span class="line">	mov word ptr es:[7ch*4],200h</span><br><span class="line">	mov word ptr es:[7ch*4+2],0</span><br><span class="line"></span><br><span class="line">	mov ax,4c00h</span><br><span class="line">	int 21h</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">lp: </span><br><span class="line">    ;cx=循环次数，bx=位移</span><br><span class="line">    push bp</span><br><span class="line">    mov bp,sp</span><br><span class="line">    dec cx</span><br><span class="line">    jcxz lpret</span><br><span class="line">    add [bp+2],bx</span><br><span class="line">lpret:</span><br><span class="line">    pop bp</span><br><span class="line">    iret</span><br><span class="line">lp_end:</span><br><span class="line">    nop</span><br><span class="line"></span><br><span class="line">code ends</span><br><span class="line">end start</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>省略</li>
</ol>
<h3 id="实验14"><a href="#实验14" class="headerlink" title="实验14"></a>实验14</h3><h4 id="实验内容-14"><a href="#实验内容-14" class="headerlink" title="实验内容"></a>实验内容</h4><p><img src="/imgs/2025050605.jpg"></p>
<h4 id="实验过程及结论-13"><a href="#实验过程及结论-13" class="headerlink" title="实验过程及结论"></a>实验过程及结论</h4><p>实验14，相应模块教材中都有代码，详细过程不再赘述<br>代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">;编程：在屏幕中间显示当前的月份</span><br><span class="line"></span><br><span class="line">assume cs:code</span><br><span class="line">d1 segment</span><br><span class="line">      db &quot;YY/MM/DD HH:MM:SS&quot;,0</span><br><span class="line">d1 ends</span><br><span class="line"></span><br><span class="line">d2 segment</span><br><span class="line">      db 9,8,7,4,2,0,88</span><br><span class="line">d2 ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">      mov ax,d1</span><br><span class="line">      mov ds,ax</span><br><span class="line">      mov ax,d2</span><br><span class="line">      mov es,ax</span><br><span class="line">      mov si,0</span><br><span class="line">      mov di,0</span><br><span class="line"></span><br><span class="line">s:    mov al,es:[di]</span><br><span class="line">      cmp al,88</span><br><span class="line">      je ok</span><br><span class="line">      out 70h,al</span><br><span class="line">      in al,71h</span><br><span class="line">      ;向地址端口70h写入要访问的单元地址</span><br><span class="line">      ;从数据端口71h取得指定单元的数据</span><br><span class="line"></span><br><span class="line">      mov ah,al</span><br><span class="line">      mov cl,4</span><br><span class="line">      shr ah,cl</span><br><span class="line">      and al,00001111b</span><br><span class="line"></span><br><span class="line">      add ah,30h</span><br><span class="line">      add al,30h</span><br><span class="line">      mov byte ptr ds:[si],ah</span><br><span class="line">      mov byte ptr ds:[si+1],al</span><br><span class="line"></span><br><span class="line">      add si,3</span><br><span class="line">      inc di</span><br><span class="line">      jmp s</span><br><span class="line">ok:   mov ax,0b800h</span><br><span class="line">      mov es,ax</span><br><span class="line">      mov di,160*12+40*2</span><br><span class="line">      mov si,0</span><br><span class="line">      mov ah,2</span><br><span class="line"></span><br><span class="line">s1:   mov al,ds:[si]</span><br><span class="line">      cmp al,0</span><br><span class="line">      je ok1</span><br><span class="line">      mov byte ptr es:[di],al</span><br><span class="line">      mov byte ptr es:[di+1],ah</span><br><span class="line">      inc si</span><br><span class="line">      add di,2</span><br><span class="line">      jmp s1</span><br><span class="line">ok1:  mov ax,4c00h</span><br><span class="line">      int 21h</span><br><span class="line"></span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>
<p>实验结果截图如下：<br><img src="/imgs/2025050606.jpg"></p>
<h3 id="实验15"><a href="#实验15" class="headerlink" title="实验15"></a>实验15</h3><h4 id="实验内容-15"><a href="#实验内容-15" class="headerlink" title="实验内容"></a>实验内容</h4><p><img src="/imgs/2025050701.jpg"><br><img src="/imgs/2025050702.jpg"></p>
<h4 id="实验过程及结论-14"><a href="#实验过程及结论-14" class="headerlink" title="实验过程及结论"></a>实验过程及结论</h4><p>代码如下，教材中有相应模块的代码，只需要简单地修改即可完成实验。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">assume cs:code</span><br><span class="line"></span><br><span class="line">stack segment</span><br><span class="line"> db 128 dup (0)</span><br><span class="line">stack ends</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:	mov ax,stack</span><br><span class="line">	mov ss,ax</span><br><span class="line">	mov sp,128</span><br><span class="line"></span><br><span class="line">	push cs</span><br><span class="line">	pop ds</span><br><span class="line"></span><br><span class="line">	mov ax,0</span><br><span class="line">	mov es,ax</span><br><span class="line"></span><br><span class="line">	mov si,offset int9			;设置ds:si指向源地址</span><br><span class="line">	mov di,204h				;设置es:di指向目的地址</span><br><span class="line">	mov cx,offset int9end - offset int9	;设置cx为传输长度</span><br><span class="line">	cld					;设置传输方向为正</span><br><span class="line">	rep movsb	</span><br><span class="line"></span><br><span class="line">	push es:[9*4]</span><br><span class="line">	pop es:[200h]</span><br><span class="line">	push es:[9*4+2]</span><br><span class="line">	pop es:[202h]</span><br><span class="line"></span><br><span class="line">	cli</span><br><span class="line">	mov word ptr es:[9*4],204h</span><br><span class="line">        mov word ptr es:[9*4+2],0</span><br><span class="line">	sti</span><br><span class="line">	</span><br><span class="line">	mov ax,4c00h</span><br><span class="line">	int 21h</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> int9:	push ax</span><br><span class="line">	push bx</span><br><span class="line">	push cx</span><br><span class="line">	push es</span><br><span class="line">        </span><br><span class="line">	in al,60h</span><br><span class="line"></span><br><span class="line">	pushf        </span><br><span class="line">        call dword ptr cs:[200h] 	;当此中断例程执行时(CS)=0</span><br><span class="line">	cmp al,9eh			;A的扫描码为1Eh，断码为1Eh+80h=9eh</span><br><span class="line">	jne int9ret</span><br><span class="line">	mov ax,0b800h</span><br><span class="line">	mov es,ax</span><br><span class="line">	mov bx,0</span><br><span class="line">	mov cx,2000</span><br><span class="line">s:	</span><br><span class="line">	mov byte ptr es:[bx],&#x27;A&#x27;</span><br><span class="line">	add bx,2</span><br><span class="line">	loop s</span><br><span class="line"></span><br><span class="line">int9ret:pop es</span><br><span class="line">	pop cx</span><br><span class="line">	pop bx</span><br><span class="line">	pop ax</span><br><span class="line">	iret</span><br><span class="line"></span><br><span class="line">int9end:nop</span><br><span class="line"></span><br><span class="line">code ends</span><br><span class="line">end start</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="实验16"><a href="#实验16" class="headerlink" title="实验16"></a>实验16</h3><h4 id="实验内容-16"><a href="#实验内容-16" class="headerlink" title="实验内容"></a>实验内容</h4><p><img src="/imgs/2025051408.jpg"></p>
<h4 id="实验过程及结论-15"><a href="#实验过程及结论-15" class="headerlink" title="实验过程及结论"></a>实验过程及结论</h4><p>做实验16时遇到一些小问题，在安装完中断例程后，在调用中断后，使用中断中的call指令调用其它程序（严格来说不是其它程序，是中断例程中的其它行的代码）。<br>通过debug调试发现，这是因为中断例程中的代码，使用直接定址表时，无法跳回到正确的内存地址。原因是：<br>汇编代码是转换成机器码放到内存中的，当其从一个内存地址复制到另一个内存地址时，譬如直接定址表语句”table dw sub1,sub2,sub3,sub4”<br>或者使用到偏移（如”offset sub1）等语句，在新的内存地址调用时，其偏移的值还是原来的值。如果代码放的新地址，初始偏移和原偏移不一致，那么类似的通过地址偏移定址的语句就会发生错误。为了防止出现该错误，本实验代码中采取了两个修改措施：1.直接修改直接定址表中的内容2.在代码中使用“基址+偏移”方法定址时，直接加上新地址与原地址的偏移量之差。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><span class="line">;安装新的int7ch中断例程</span><br><span class="line">assume cs:code</span><br><span class="line">code segment</span><br><span class="line">;子程序setscreen，为显示输出提供如下功能：</span><br><span class="line">;(1) 清屏。</span><br><span class="line">;(2) 设置前景色。</span><br><span class="line">;(3) 设置背景色。</span><br><span class="line">;(4) 向上滚动一行。</span><br><span class="line">;</span><br><span class="line">;入口参数说明：</span><br><span class="line">;(1) 用 ah 寄存器传递功能号：0 表示清屏，1表示设置前景色，2 表示设置背景色，3 表示向上滚动一行；</span><br><span class="line">;(2) 对于1、2号功能，用 al 传送颜色值，(al) ∈&#123;0,1,2,3,4,5,6,7&#125;</span><br><span class="line"></span><br><span class="line">setscreen: </span><br><span class="line">	jmp short set</span><br><span class="line">	;子程序地址保存到table中</span><br><span class="line">    table dw sub1,sub2,sub3,sub4</span><br><span class="line"></span><br><span class="line">set:push bx  </span><br><span class="line">	cmp ah,3		;判断传递的是否大于 3</span><br><span class="line">	ja sret</span><br><span class="line">	mov bl,ah</span><br><span class="line">	mov bh,0</span><br><span class="line">	add bx,bx		;根据ah中的功能号计算对应子程序的地址在table表中的偏移</span><br><span class="line">	; debug</span><br><span class="line">	; 查看为什么cs:table[bx]调用失败（未转换到指定偏移值）</span><br><span class="line">; debuggg1:</span><br><span class="line">; 	push dx</span><br><span class="line">; 	mov dx,word ptr table[bx]</span><br><span class="line">; 	mov dx,word ptr cs:table[bx]</span><br><span class="line">; 	mov dx,offset table</span><br><span class="line">; 	mov dx,offset sub1</span><br><span class="line">; 	mov dx,offset sub2</span><br><span class="line">; 	pop dx</span><br><span class="line">; debuggg1_end:</span><br><span class="line">	;虽然在ept161中已经将table[bx]的值相应地修改，但是在这个中断例程中直接调用table时（即offset table的值），偏移值仍是原来的0002h。</span><br><span class="line">	call word ptr cs:table[bx+200h]</span><br><span class="line"></span><br><span class="line">sret:</span><br><span class="line">	pop bx	</span><br><span class="line">	iret</span><br><span class="line"></span><br><span class="line">;功能子程序1：清屏</span><br><span class="line">sub1:   push bx</span><br><span class="line">		push cx</span><br><span class="line">        push es</span><br><span class="line">        mov bx,0b800h</span><br><span class="line">        mov es,bx</span><br><span class="line">        mov bx,0</span><br><span class="line">        mov cx,2000</span><br><span class="line">sub1s:  mov byte ptr es:[bx],&#x27; &#x27;</span><br><span class="line">        add bx,2</span><br><span class="line">        loop sub1s</span><br><span class="line">        pop es</span><br><span class="line">        pop cx</span><br><span class="line">        pop bx</span><br><span class="line">	ret ;sub1 ends</span><br><span class="line"></span><br><span class="line">;功能子程序2：设置前景色</span><br><span class="line">sub2:	</span><br><span class="line">	push bx</span><br><span class="line">	push cx</span><br><span class="line">	push es</span><br><span class="line"></span><br><span class="line">	mov bx,0b800h</span><br><span class="line">	mov es,bx</span><br><span class="line">	mov bx,1</span><br><span class="line">	mov cx,2000</span><br><span class="line">sub2s:	</span><br><span class="line">	and byte ptr es:[bx],11111000b	</span><br><span class="line">	or es:[bx],al </span><br><span class="line">	add bx,2</span><br><span class="line">	loop sub2s</span><br><span class="line"></span><br><span class="line">	pop es</span><br><span class="line">	pop cx</span><br><span class="line">	pop bx</span><br><span class="line">	ret ;sub2 ends</span><br><span class="line"></span><br><span class="line">;功能子程序3：设置背景色</span><br><span class="line">sub3:	</span><br><span class="line">	push bx</span><br><span class="line">	push cx</span><br><span class="line">	push es</span><br><span class="line">	mov cl,4</span><br><span class="line">	shl al,cl</span><br><span class="line">	mov bx,0b800h</span><br><span class="line">	mov es,bx</span><br><span class="line">	mov bx,1</span><br><span class="line">	mov cx,2000</span><br><span class="line">sub3s:	</span><br><span class="line">	and byte ptr es:[bx],10001111b</span><br><span class="line">	or es:[bx],al </span><br><span class="line">	add bx,2</span><br><span class="line">	loop sub3s</span><br><span class="line"></span><br><span class="line">	pop es</span><br><span class="line">	pop cx</span><br><span class="line">	pop bx</span><br><span class="line">	ret ; sub3 ends</span><br><span class="line"></span><br><span class="line">;功能子程序4：向上滚动一行</span><br><span class="line">sub4:	</span><br><span class="line">	push cx</span><br><span class="line">	push si</span><br><span class="line">	push di</span><br><span class="line">	push es</span><br><span class="line">	push ds</span><br><span class="line"></span><br><span class="line">	mov si,0b800h</span><br><span class="line">	mov es,si</span><br><span class="line">	mov ds,si</span><br><span class="line">	mov si,160			;ds:si指向第n+1行</span><br><span class="line">	mov di,0			;es:di指向第n行</span><br><span class="line">	cld</span><br><span class="line">	mov cx,24;共复制24行</span><br><span class="line"></span><br><span class="line">sub4s:	</span><br><span class="line">	push cx</span><br><span class="line">	mov cx,160</span><br><span class="line">	rep movsb 			;复制</span><br><span class="line">  	pop cx</span><br><span class="line">	loop sub4s</span><br><span class="line"></span><br><span class="line">	mov cx,80	</span><br><span class="line">	mov si,0</span><br><span class="line">sub4s1: </span><br><span class="line">	mov byte ptr es:[160*24+si],&#x27; &#x27;		;最后一行清空</span><br><span class="line">	add si,2</span><br><span class="line">	loop sub4s1</span><br><span class="line"></span><br><span class="line">	pop ds</span><br><span class="line">	pop es</span><br><span class="line">	pop di</span><br><span class="line">	pop si</span><br><span class="line">	pop cx</span><br><span class="line">	ret ;sub4 ends</span><br><span class="line"></span><br><span class="line">setscreen_end:</span><br><span class="line">    nop</span><br><span class="line">start:</span><br><span class="line">    mov ax,cs</span><br><span class="line">	mov ds,ax</span><br><span class="line">	mov si,offset setscreen</span><br><span class="line">	mov ax,0</span><br><span class="line">	mov es,ax</span><br><span class="line">	mov di,200h</span><br><span class="line">	mov cx,offset setscreen_end - offset setscreen</span><br><span class="line">	cld</span><br><span class="line">	rep movsb</span><br><span class="line"></span><br><span class="line">	; debug</span><br><span class="line"> 	; 查看代码复制情况</span><br><span class="line">	; 这里卡了一天多用debug看值才找到问题哈哈哈哈，</span><br><span class="line">	; table和screen之间也是有距离的，之前一直只考虑了200h，其实偏移还要加上offset table - offset setscreen</span><br><span class="line">	; 问题点不难但是找的过程中有点轴，纪念一下（狗头</span><br><span class="line"></span><br><span class="line">; debuggg:</span><br><span class="line">; 	push ax</span><br><span class="line">; 	push bx</span><br><span class="line">; 	push cx</span><br><span class="line"></span><br><span class="line">; 	mov bx,0</span><br><span class="line">; 	mov cx,4</span><br><span class="line">; tt:</span><br><span class="line">; 	mov ax,word ptr cs:table[bx]</span><br><span class="line">; 	mov ax,word ptr es:[200h + (offset table - offset setscreen) + bx]</span><br><span class="line">; 	mov ax,offset table - offset setscreen</span><br><span class="line">; 	add bx,2</span><br><span class="line">; 	loop tt</span><br><span class="line"></span><br><span class="line">; 	pop cx</span><br><span class="line">; 	pop bx</span><br><span class="line">; 	pop ax</span><br><span class="line">; debuggg_end:</span><br><span class="line">; 	nop</span><br><span class="line"></span><br><span class="line">adjust_table:</span><br><span class="line">	push ax</span><br><span class="line">	push bx</span><br><span class="line">	push cx</span><br><span class="line">	push es</span><br><span class="line"></span><br><span class="line">	mov ax,0</span><br><span class="line">	mov es,ax</span><br><span class="line">	mov bx,0</span><br><span class="line">	mov cx,4</span><br><span class="line">	mov ax,200h</span><br><span class="line">	sub ax,offset setscreen</span><br><span class="line">s:	add word ptr es:[200h + (offset table - offset setscreen) + bx],ax</span><br><span class="line">	add bx,2</span><br><span class="line">	loop s</span><br><span class="line"></span><br><span class="line">	pop es</span><br><span class="line">	pop cx</span><br><span class="line">	pop bx</span><br><span class="line">	pop ax</span><br><span class="line">adjust_end:</span><br><span class="line">	nop</span><br><span class="line"></span><br><span class="line">	cli</span><br><span class="line">	mov word ptr es:[7ch*4],200h</span><br><span class="line">	mov word ptr es:[7ch*4+2],0</span><br><span class="line">	sti</span><br><span class="line"></span><br><span class="line">	mov ax,4c00h</span><br><span class="line">	int 21h</span><br><span class="line"></span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>
<p>红色的汇编原码，转换成的机器码，如图所示，这里不再解释机器码的意义，反正复制到新地址后，执行该语句，得到的值仍是原来的偏移。<br><img src="/imgs/2025051403.jpg"><br>实验中0、1、2、3号功能效果依次如下图所示：<br><img src="/imgs/2025051404.jpg"><br><img src="/imgs/2025051405.jpg"><br><img src="/imgs/2025051406.jpg"><br><img src="/imgs/2025051407.jpg"></p>
<h3 id="实验17"><a href="#实验17" class="headerlink" title="实验17"></a>实验17</h3><h4 id="实验内容-17"><a href="#实验内容-17" class="headerlink" title="实验内容"></a>实验内容</h4><p><img src="/imgs/2025051502.jpg"><br><img src="/imgs/2025051503.jpg"></p>
<h4 id="实验过程及结论-16"><a href="#实验过程及结论-16" class="headerlink" title="实验过程及结论"></a>实验过程及结论</h4><p>实验17在测试代码时发现错误，单独用程序测试后发现DOSBOX没有模拟int13h号中断，所以这里只写了代码，没有验证代码的可行性，按理来说应该没问题（狗头）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">assume cs:code</span><br><span class="line">code segment</span><br><span class="line">	; 安装新的int7ch中断例程</span><br><span class="line">	; 参数说明：</span><br><span class="line">	; (1)用ah寄存器传递功能号:0表示读，1表示写</span><br><span class="line">	; (2)用dx寄存器传递要读写的扇区的逻辑扇区号</span><br><span class="line">	; (3)用es:bx指向存储读出数据或写入数据的内存区。</span><br><span class="line"></span><br><span class="line">	; 逻辑扇区号=(面号*80+磁道号)*18+扇区号-1</span><br><span class="line">	; 那么如何根据逻辑扇区号算出物理编号呢?可以用下面的算法。</span><br><span class="line">	; int():描述性运算符，取商</span><br><span class="line">	; rem():描述性运算符，取余数</span><br><span class="line">	; 逻辑扇区号=(面号*80+磁道号)*18+扇区号-1</span><br><span class="line">	; 面号=int(逻辑扇区号/1440)</span><br><span class="line">	; 磁道号=int(rem(逻辑扇区号/1440)/18)</span><br><span class="line">	; 扇区号=rem(rem(逻辑扇区号/1440)/18)+1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	;div除法指令规则</span><br><span class="line">    ;被除数16位，除数8位：被除数ax，除数 (含8位及以内有效数值)寄存器，商al，余数ah</span><br><span class="line">    ;被除数32位，除数16位：被除数高位dx，低位ax，除数 (含16位及以内有效数值)寄存器，商ax，余数dx</span><br><span class="line"></span><br><span class="line">    ;mul乘法指令法则</span><br><span class="line">    ;两个相乘的数，位数需一致</span><br><span class="line">    ;8位:两个乘数一个在al中，另一个在8位reg或内存字节单元中，结果在ax中</span><br><span class="line">    ;16位:两个乘数个在ax中，另一个在16位reg或内存字节单元中，结果高位dx，低位ax</span><br><span class="line">int7ch_program:</span><br><span class="line">	;将int7ch参数调整为int13h参数</span><br><span class="line">	push ax</span><br><span class="line">	push bx</span><br><span class="line"></span><br><span class="line">	mov ax,dx</span><br><span class="line">	mov bx,1440</span><br><span class="line">	div bx</span><br><span class="line">	mov dh,al</span><br><span class="line">	;dh传递 面号=int(逻辑扇区号/1440)</span><br><span class="line"></span><br><span class="line">	mov al,ah</span><br><span class="line">	mov ah,0</span><br><span class="line">	mov bx,18</span><br><span class="line">	div bx</span><br><span class="line">	mov ch,al</span><br><span class="line">	;ch传递 磁道号=int(rem(逻辑扇区号/1440)/18)</span><br><span class="line"></span><br><span class="line">	add ah,1</span><br><span class="line">	mov cl,ah</span><br><span class="line">	;cl传递 扇区号=rem(rem(逻辑扇区号/1440)/18)+1</span><br><span class="line"></span><br><span class="line">	pop bx</span><br><span class="line">	pop ax</span><br><span class="line"></span><br><span class="line">	add ah,2</span><br><span class="line">	;ah传递 int 13h 的读取数据功能号，2为读取，3为写入</span><br><span class="line"></span><br><span class="line">	mov al,1</span><br><span class="line">	;写入的扇区数</span><br><span class="line"></span><br><span class="line">	mov dl,80h</span><br><span class="line">	;用dl传递驱动器号</span><br><span class="line">    ;硬盘从80h开始，</span><br><span class="line">	;80h：硬盘C，</span><br><span class="line">	;81h：硬盘D，</span><br><span class="line">	;82h：硬盘E，</span><br><span class="line">	;83h：硬盘F，</span><br><span class="line">	;84h：硬盘G，</span><br><span class="line">	;85h：硬盘H</span><br><span class="line">	;al传递需要读入/写入的扇区数</span><br><span class="line">	;es:bx	指向接收从扇区读取数据的内存区，因为int7ch与int13h该参数相同，所以不做调整</span><br><span class="line">	int 13h</span><br><span class="line">return:</span><br><span class="line">	iret</span><br><span class="line">int7ch_program_end:</span><br><span class="line"></span><br><span class="line">start:</span><br><span class="line">	;安装新的int7ch中断例程</span><br><span class="line">    mov ax,cs</span><br><span class="line">	mov ds,ax</span><br><span class="line">	mov si,offset int7ch_program</span><br><span class="line">	mov ax,0</span><br><span class="line">	mov es,ax</span><br><span class="line">	mov di,200h</span><br><span class="line">	mov cx,offset int7ch_program_end - offset int7ch_program</span><br><span class="line">	cld</span><br><span class="line">	rep movsb</span><br><span class="line"></span><br><span class="line">	cli</span><br><span class="line">	mov word ptr es:[7ch*4],200h</span><br><span class="line">	mov word ptr es:[7ch*4+2],0</span><br><span class="line">	sti</span><br><span class="line"></span><br><span class="line">	mov ax,4c00h</span><br><span class="line">	int 21h</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>
    </div>

    
    <div class="about">
        <h1>About this Post</h1>
        <div class="details">
            <p>This post is written by KeplerXXIIb, licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc/4.0">CC BY-NC 4.0</a>.</p>
        </div>
        
        <p class="tags">
            
            <i class="icon"></i>
            <a href="/tags/CS/" class="tag">#CS</a>
        </p>
        
    </div>
    

    <div class="container post-prev-next">
        <a class="next"></a>
        
        <a href="/2025/03/27/LearningCompilationPrinciple&amp;AssemblyLanguage/" class="prev">
            <div>
                <div class="text">
                    <p class="label">Previous</p>
                    <h3 class="title">学习编译原理与汇编！</>
                </div>
            </div>
        </a>
        
    </div>

    
        
        
    
</article>

        <footer>
    <div class="inner">
        <div class="links">
            
            <div class="group">
                <h2 class="title">Blog</h2>
                
                <a href="/" class="item">Blog</a>
                
                <a href="/archives" class="item">Archives</a>
                
                <a href="/tags" class="item">Tags</a>
                
                <a href="/categories" class="item">Categories</a>
                
                <a href="/search" class="item">Search</a>
                
                <a href="/friends" class="item">Friends</a>
                
                <a href="/projects" class="item">Projects</a>
                
                <a href="/resume" class="item">Resume</a>
                
                <a href="/about" class="item">About</a>
                
                <a href="/atom.xml" class="item">RSS</a>
                
            </div>
            
            <div class="group">
                <h2 class="title">Projects</h2>
                
                <a target="_blank" rel="noopener" href="https://github.com/KeplerXXIIb/CS-Learning" class="item">C-Learning</a>
                
            </div>
            
            <div class="group">
                <h2 class="title">Me</h2>
                
                <a target="_blank" rel="noopener" href="https://github.com/KeplerXXIIb" class="item">GitHub</a>
                
                <a href="QQ:936474910@qq.com" class="item">Email</a>
                
            </div>
            
        </div>
        <span>&copy; 2025 KeplerXXIIb<br>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> </span>
        
        
            <br>
            <div class="color-scheme-toggle" role="radiogroup" id="theme-color-scheme-toggle">
                <label>
                    <input type="radio" value="light">
                    <span>Light</span>
                </label>
                <label>
                    <input type="radio" value="dark">
                    <span>Dark</span>
                </label>
                <label>
                    <input type="radio" value="auto">
                    <span>Auto</span>
                </label>
            </div>
        
    </div>
</footer>


        
<script src="/js/main.js"></script>

        
        
        

        
        <script src="https://unpkg.com/scrollreveal"></script>
        <script>
            window.addEventListener('load', () => {
                ScrollReveal({ delay: 250, reset: true, easing: 'cubic-bezier(0, 0, 0, 1)' })
                ScrollReveal().reveal('.post-list-item .cover-img img')
                ScrollReveal().reveal('.post-list-item, .card, .content p img, .content .block-large img', { distance: '60px', origin: 'bottom', duration: 800 })
            })
        </script>
        
    </body>
</html>